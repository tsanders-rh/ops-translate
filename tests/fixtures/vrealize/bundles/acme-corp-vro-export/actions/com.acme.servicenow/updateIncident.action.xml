<?xml version="1.0" encoding="UTF-8"?>
<action xmlns="http://vmware.com/vco/action" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://vmware.com/vco/action http://vmware.com/vco/action" version="1.0.0" api-version="8.0.0">
  <display-name>Update ServiceNow Incident</display-name>
  <description>Updates an existing ServiceNow incident status</description>
  <module>com.acme.servicenow</module>

  <input>
    <param name="incidentNumber" type="string">
      <description>Incident number to update</description>
    </param>
    <param name="status" type="string">
      <description>New status (In Progress/Resolved/Closed)</description>
    </param>
  </input>

  <output>
    <param name="success" type="boolean">
      <description>Whether update was successful</description>
    </param>
  </output>

  <script><![CDATA[
// ServiceNow incident update
// Get ServiceNow connection
var snow = System.getModule("com.vmware.library.servicenow").getConnection();

// Prepare update data
var update = {
  state: status,
  work_notes: "Updated by vRealize Orchestrator automation"
};

// Update incident via REST API
var url = "https://servicenow-prod.acme.com/api/now/table/incident?number=" + incidentNumber;
var response = restClient.put(url, JSON.stringify(update));

success = (response.statusCode === 200);

if (success) {
  System.log("Updated ServiceNow incident " + incidentNumber + " to status: " + status);
} else {
  System.warn("Failed to update ServiceNow incident: " + response.statusCode);
}

return success;
]]></script>
</action>
