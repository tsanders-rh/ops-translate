<?xml version="1.0" encoding="UTF-8"?>
<action xmlns="http://vmware.com/vco/action" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://vmware.com/vco/action http://vmware.com/vco/action" version="1.0.0" api-version="8.0.0">
  <display-name>Create NSX Firewall Rule</display-name>
  <description>Creates a new NSX-T distributed firewall rule</description>
  <module>com.acme.nsx</module>

  <input>
    <param name="ruleName" type="string">
      <description>Name of the firewall rule</description>
    </param>
    <param name="sourceGroup" type="string">
      <description>Source security group</description>
    </param>
    <param name="destinationGroup" type="string">
      <description>Destination security group</description>
    </param>
  </input>

  <output>
    <param name="ruleId" type="string">
      <description>Created firewall rule ID</description>
    </param>
  </output>

  <script><![CDATA[
// NSX-T distributed firewall rule creation
// Get NSX client
var nsxClient = System.getModule("com.vmware.library.nsx").getNsxClient();

// Create firewall rule
var rule = nsxClient.createFirewallRule({
  display_name: ruleName,
  source_groups: ["/infra/domains/default/groups/" + sourceGroup],
  destination_groups: ["/infra/domains/default/groups/" + destinationGroup],
  services: ["ANY"],
  action: "ALLOW",
  logged: true,
  sequence_number: 100
});

ruleId = rule.id;
System.log("Created NSX firewall rule: " + ruleId + " (name: " + ruleName + ")");
System.log("  Source: " + sourceGroup);
System.log("  Destination: " + destinationGroup);

return ruleId;
]]></script>
</action>
