<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture</title>
    <link rel="stylesheet" href="../assets/style.css">
    <style>
        .doc-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-xl);
            background: white;
        }
        .doc-header {
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid #0c4a6e;
        }
        .doc-nav {
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-md);
            background: #f0f9ff;
            border-radius: 8px;
        }
        .doc-nav a {
            color: #0c4a6e;
            text-decoration: none;
            margin-right: var(--spacing-md);
        }
        .doc-nav a:hover {
            text-decoration: underline;
        }
        .doc-content {
            line-height: 1.8;
        }
        .doc-content h2 {
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-lg);
            border-top: 1px solid #e2e8f0;
        }
        .doc-content h3 {
            margin-top: var(--spacing-lg);
            color: #0c4a6e;
        }
        .doc-content h4 {
            margin-top: var(--spacing-md);
            color: #0369a1;
            font-weight: 600;
        }
        .doc-content code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
        }
        .doc-content pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: var(--spacing-md);
            border-radius: 8px;
            overflow-x: auto;
            margin: var(--spacing-md) 0;
        }
        .doc-content pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }
        .doc-content table {
            width: 100%;
            border-collapse: collapse;
            margin: var(--spacing-md) 0;
        }
        .doc-content th, .doc-content td {
            border: 1px solid #cbd5e1;
            padding: var(--spacing-sm);
            text-align: left;
        }
        .doc-content th {
            background: #f1f5f9;
            font-weight: 600;
        }
        .doc-content ul, .doc-content ol {
            margin: var(--spacing-md) 0;
            padding-left: var(--spacing-xl);
        }
        .doc-content li {
            margin: var(--spacing-xs) 0;
        }
        .doc-content blockquote {
            border-left: 4px solid #0c4a6e;
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: #64748b;
            font-style: italic;
        }
        .back-to-report {
            display: inline-block;
            margin-top: var(--spacing-xl);
            padding: var(--spacing-sm) var(--spacing-md);
            background: #0c4a6e;
            color: white;
            text-decoration: none;
            border-radius: 6px;
        }
        .back-to-report:hover {
            background: #075985;
        }
    </style>
</head>
<body>
    <div class="doc-container">
        <div class="doc-header">
            <h1>Architecture</h1>
        </div>
        <div class="doc-nav">
            <a href="../index.html">← Back to Report</a>
            <a href="#table-of-contents">Table of Contents</a>
        </div>
        <div class="doc-content">
            <h1 id="ops-translate-architecture">ops-translate Architecture</h1>
<p>Technical architecture and design documentation for ops-translate.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#system-overview">System Overview</a></li>
<li><a href="#core-concepts">Core Concepts</a></li>
<li><a href="#what-is-intent">What is "Intent"?</a></li>
<li><a href="#why-merge-multiple-sources">Why Merge Multiple Sources?</a></li>
<li><a href="#merge-strategies">Merge Strategies</a></li>
<li><a href="#conflict-detection">Conflict Detection</a></li>
<li><a href="#architecture-principles">Architecture Principles</a></li>
<li><a href="#component-architecture">Component Architecture</a></li>
<li><a href="#data-flow">Data Flow</a></li>
<li><a href="#intent-schema">Intent Schema</a></li>
<li><a href="#llm-integration">LLM Integration</a></li>
<li><a href="#generation-pipeline">Generation Pipeline</a></li>
<li><a href="#extension-points">Extension Points</a></li>
</ol>
<h2 id="system-overview">System Overview</h2>
<h3 id="high-level-architecture">High-Level Architecture</h3>
<div class="codehilite"><pre><span></span><code>┌─────────────────────────────────────────────────────────────┐
│                    ops-translate CLI                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌───────────┐    ┌───────────┐    ┌───────────┐            │
│  │  Import   │───▶│  Extract  │───▶│   Merge   │            │
│  │  Module   │    │  Module   │    │  Module   │            │
│  └───────────┘    └───────────┘    └───────────┘            │
│        │                 │                  │               │
│        ▼                 ▼                  ▼               │
│  ┌───────────────────────────────────────────────────┐      │
│  │            Operational Intent Store               │      │
│  │         (YAML files in intent/ directory)         │      │
│  └───────────────────────────────────────────────────┘      │
│                          │                                  │
│                          ▼                                  │
│                  ┌───────────┐                              │
│                  │ Generate  │                              │
│                  │  Module   │                              │
│                  └───────────┘                              │
│                       │    │                                │
│              ┌────────┘    └────────┐                       │
│              ▼                      ▼                       │
│      ┌─────────────┐        ┌─────────────┐                 │
│      │   Ansible   │        │  KubeVirt   │                 │
│      │ Generator   │        │  Generator  │                 │
│      └─────────────┘        └─────────────┘                 │
│              │                       │                      │
└──────────────┼───────────────────────┼──────────────────────┘
               │                       │
               ▼                       ▼
        output/ansible/        output/kubevirt/
</code></pre></div>

<h3 id="key-components">Key Components</h3>
<ol>
<li><strong>CLI Layer</strong> (<code>ops_translate/cli.py</code>)</li>
<li>Command-line interface using Typer</li>
<li>Workspace management</li>
<li>
<p>User interaction</p>
</li>
<li>
<p><strong>Import Module</strong> (<code>ops_translate/workspace.py</code>)</p>
</li>
<li>File copying and validation</li>
<li>Metadata tracking</li>
<li>
<p>Hash computation for integrity</p>
</li>
<li>
<p><strong>Summarize Module</strong> (<code>ops_translate/summarize/</code>)</p>
</li>
<li>Static analysis without AI</li>
<li>Pattern detection (PowerCLI and vRealize)</li>
<li>
<p>Markdown report generation</p>
</li>
<li>
<p><strong>Extract Module</strong> (<code>ops_translate/intent/extract.py</code>)</p>
</li>
<li>LLM-powered intent extraction</li>
<li>Template-based extraction (no-AI mode)</li>
<li>
<p>Assumptions logging</p>
</li>
<li>
<p><strong>Merge Module</strong> (<code>ops_translate/intent/merge.py</code>)</p>
</li>
<li>Smart merging of multiple intent sources</li>
<li>Conflict detection and reporting</li>
<li>
<p>Resolution strategies</p>
</li>
<li>
<p><strong>Validate Module</strong> (<code>ops_translate/intent/validate.py</code>)</p>
</li>
<li>Intent schema validation</li>
<li>Artifact validation</li>
<li>
<p>Dry-run checks</p>
</li>
<li>
<p><strong>Generate Module</strong> (<code>ops_translate/generate/</code>)</p>
</li>
<li>Ansible playbook generation</li>
<li>KubeVirt manifest generation</li>
<li>Ansible role generation with translated tasks</li>
<li>
<p>Profile-based customization</p>
</li>
<li>
<p><strong>Translate Module</strong> (<code>ops_translate/translate/</code>)</p>
</li>
<li>Deterministic PowerCLI → Ansible task translation</li>
<li>vRealize workflow → Ansible task translation</li>
<li>Cmdlet mapping and parameter substitution</li>
<li>
<p>Profile-driven adapter generation</p>
</li>
<li>
<p><strong>LLM Module</strong> (<code>ops_translate/llm/</code>)</p>
</li>
<li>Provider abstraction (Anthropic, OpenAI, Mock)</li>
<li>Prompt management</li>
<li>Response parsing</li>
</ol>
<h2 id="core-concepts">Core Concepts</h2>
<h3 id="what-is-intent">What is "Intent"?</h3>
<p><strong>Intent</strong> is a normalized, platform-agnostic representation of <strong>what</strong> should happen, separated from <strong>how</strong> it happens.</p>
<p><strong>Example transformation:</strong></p>
<p><strong>VMware PowerCLI (imperative - "how"):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">param</span><span class="p">(</span><span class="no">[string]</span><span class="nv">$VMName</span><span class="p">,</span> <span class="p">[</span><span class="k">ValidateSet</span><span class="p">(</span><span class="s2">&quot;dev&quot;</span><span class="p">,</span><span class="s2">&quot;prod&quot;</span><span class="p">)]</span><span class="no">[string]</span><span class="nv">$Env</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$Env</span> <span class="o">-eq</span> <span class="s2">&quot;prod&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$Network</span> <span class="p">=</span> <span class="s2">&quot;prod-network&quot;</span>
    <span class="nv">$CPU</span> <span class="p">=</span> <span class="n">4</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$Network</span> <span class="p">=</span> <span class="s2">&quot;dev-network&quot;</span>
    <span class="nv">$CPU</span> <span class="p">=</span> <span class="n">2</span>
<span class="p">}</span>
<span class="nb">New-VM</span> <span class="n">-Name</span> <span class="nv">$VMName</span> <span class="n">-NumCPU</span> <span class="nv">$CPU</span> <span class="n">-NetworkName</span> <span class="nv">$Network</span>
</code></pre></div>

<p><strong>Operational Intent (declarative - "what"):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">intent</span><span class="p">:</span>
<span class="w">  </span><span class="nt">workflow_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">provision_vm</span>
<span class="w">  </span><span class="nt">workload_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtual_machine</span>

<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="nt">vm_name</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">string</span><span class="p p-Indicator">,</span><span class="nt"> required</span><span class="p">:</span><span class="w"> </span><span class="nv">true</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">enum</span><span class="p p-Indicator">,</span><span class="nt"> values</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">dev</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">prod</span><span class="p p-Indicator">],</span><span class="nt"> required</span><span class="p">:</span><span class="w"> </span><span class="nv">true</span><span class="w"> </span><span class="p p-Indicator">}</span>

<span class="w">  </span><span class="nt">profiles</span><span class="p">:</span>
<span class="w">    </span><span class="nt">network</span><span class="p">:</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> environment</span><span class="p">:</span><span class="w"> </span><span class="nv">prod</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod-network</span>
<span class="w">    </span><span class="nt">network_else</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev-network</span>

<span class="w">    </span><span class="nt">cpu</span><span class="p">:</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> environment</span><span class="p">:</span><span class="w"> </span><span class="nv">prod</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">    </span><span class="nt">cpu_else</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</code></pre></div>

<p><strong>Why is this useful?</strong>
- ✅ <strong>Platform-agnostic</strong>: No VMware-specific commands or syntax
- ✅ <strong>Declarative</strong>: Describes desired outcome, not implementation steps
- ✅ <strong>Portable</strong>: Can generate Ansible, Terraform, KubeVirt, or other formats
- ✅ <strong>Validatable</strong>: Conforms to a JSON schema for correctness checking
- ✅ <strong>Reviewable</strong>: Human-readable YAML that makes operational logic explicit</p>
<h3 id="why-merge-multiple-sources">Why Merge Multiple Sources?</h3>
<p>Organizations often have <strong>multiple automation scripts</strong> that overlap or complement each other:
- Separate scripts for dev vs. prod environments
- Different scripts for different VM types (web, database, etc.)
- vRealize workflows for governance/approvals
- PowerCLI scripts for Day 2 operations</p>
<p>Instead of translating each source independently and managing separate outputs, ops-translate <strong>merges</strong> them into a unified intent that captures the complete operational picture.</p>
<p><strong>Example: Two scripts doing similar things</strong></p>
<p><strong>Source 1: <code>dev-vm.ps1</code></strong> (simpler, for development)</p>
<div class="codehilite"><pre><span></span><code><span class="nt">intent</span><span class="p">:</span>
<span class="w">  </span><span class="nt">workflow_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">provision_dev_vm</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="nt">vm_name</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">string</span><span class="p p-Indicator">,</span><span class="nt"> required</span><span class="p">:</span><span class="w"> </span><span class="nv">true</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">integer</span><span class="p p-Indicator">,</span><span class="nt"> default</span><span class="p">:</span><span class="w"> </span><span class="nv">2</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">compute</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cpu_cores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">memory_gb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</code></pre></div>

<p><strong>Source 2: <code>prod-vm.ps1</code></strong> (stricter, for production)</p>
<div class="codehilite"><pre><span></span><code><span class="nt">intent</span><span class="p">:</span>
<span class="w">  </span><span class="nt">workflow_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">provision_prod_vm</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="nt">vm_name</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">string</span><span class="p p-Indicator">,</span><span class="nt"> required</span><span class="p">:</span><span class="w"> </span><span class="nv">true</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">integer</span><span class="p p-Indicator">,</span><span class="nt"> default</span><span class="p">:</span><span class="w"> </span><span class="nv">4</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="nt">owner_email</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">string</span><span class="p p-Indicator">,</span><span class="nt"> required</span><span class="p">:</span><span class="w"> </span><span class="nv">true</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">compute</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cpu_cores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">    </span><span class="nt">memory_gb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span>
<span class="w">  </span><span class="nt">governance</span><span class="p">:</span>
<span class="w">    </span><span class="nt">approval</span><span class="p">:</span>
<span class="w">      </span><span class="nt">required_when</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> environment</span><span class="p">:</span><span class="w"> </span><span class="nv">prod</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="nt">approvers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ops-manager@example.com</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p><strong>Merged Result:</strong> (combines best of both)</p>
<div class="codehilite"><pre><span></span><code><span class="nt">intent</span><span class="p">:</span>
<span class="w">  </span><span class="nt">workflow_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">provision_vm</span><span class="w">  </span><span class="c1"># Unified name</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="nt">vm_name</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">string</span><span class="p p-Indicator">,</span><span class="nt"> required</span><span class="p">:</span><span class="w"> </span><span class="nv">true</span><span class="w"> </span><span class="p p-Indicator">}</span><span class="w">  </span><span class="c1"># From both</span>
<span class="w">    </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">integer</span><span class="p p-Indicator">,</span><span class="nt"> required</span><span class="p">:</span><span class="w"> </span><span class="nv">false</span><span class="w"> </span><span class="p p-Indicator">}</span><span class="w">    </span><span class="c1"># Merged constraints</span>
<span class="w">    </span><span class="nt">owner_email</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> type</span><span class="p">:</span><span class="w"> </span><span class="nv">string</span><span class="p p-Indicator">,</span><span class="nt"> required</span><span class="p">:</span><span class="w"> </span><span class="nv">true</span><span class="w"> </span><span class="p p-Indicator">}</span><span class="w">  </span><span class="c1"># From prod</span>
<span class="w">  </span><span class="nt">compute</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cpu_cores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w">      </span><span class="c1"># Maximum value (prod requirement)</span>
<span class="w">    </span><span class="nt">memory_gb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span><span class="w">     </span><span class="c1"># Maximum value (prod requirement)</span>
<span class="w">  </span><span class="nt">governance</span><span class="p">:</span>
<span class="w">    </span><span class="nt">approval</span><span class="p">:</span>
<span class="w">      </span><span class="nt">required_when</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> environment</span><span class="p">:</span><span class="w"> </span><span class="nv">prod</span><span class="w"> </span><span class="p p-Indicator">}</span><span class="w">  </span><span class="c1"># Preserved from prod</span>
<span class="w">      </span><span class="nt">approvers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">ops-manager@example.com</span><span class="p p-Indicator">]</span>
</code></pre></div>

<h3 id="merge-strategies">Merge Strategies</h3>
<p>The <code>smart_merge()</code> function applies different strategies to different sections:</p>
<table>
<thead>
<tr>
<th>Section</th>
<th>Strategy</th>
<th>Rationale</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Inputs</strong></td>
<td>Union + reconcile types</td>
<td>Support all parameters from all sources</td>
</tr>
<tr>
<td><strong>Governance</strong></td>
<td>Most restrictive</td>
<td>If ANY source needs approval → merged needs it (safer)</td>
</tr>
<tr>
<td><strong>Compute</strong></td>
<td>Maximum values</td>
<td>Take highest CPU/memory to satisfy all requirements</td>
</tr>
<tr>
<td><strong>Profiles</strong></td>
<td>Union</td>
<td>Combine all environment configs (dev, staging, prod)</td>
</tr>
<tr>
<td><strong>Metadata/Tags</strong></td>
<td>Union</td>
<td>Include all tags from all sources</td>
</tr>
<tr>
<td><strong>Day 2 Operations</strong></td>
<td>Union</td>
<td>Support ALL operations mentioned in any source</td>
</tr>
</tbody>
</table>
<h3 id="conflict-detection">Conflict Detection</h3>
<p>When sources have incompatible requirements, conflicts are reported:</p>
<p><strong>Compatible differences</strong> (auto-merged):</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Source 1: cpu default is 2</span>
<span class="c1"># Source 2: cpu default is 4</span>
<span class="c1"># Merged: Takes maximum (4) or makes it required: false with no default</span>
</code></pre></div>

<p><strong>Incompatible differences</strong> (reported as conflicts):</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Source 1: cpu_count has type: integer</span>
<span class="c1"># Source 2: cpu_count has type: string  # Type mismatch!</span>
<span class="c1"># Result: Conflict reported in intent/conflicts.md</span>
</code></pre></div>

<h3 id="visual-data-flow">Visual Data Flow</h3>
<div class="codehilite"><pre><span></span><code><span class="n">VMware Sources              Intent Layer           OpenShift Output</span>
<span class="n">=============              =============          ================</span>

<span class="n">dev.ps1 ─────┐           ┌─────────────┐</span>
<span class="n">             ├──extract──&gt;│             │         KubeVirt VM</span>
<span class="n">prod.ps1 ────┤           │ *.intent.   │──┐      ├─ cpu/memory</span>
<span class="n">             │           │   yaml      │  │      ├─ networks</span>
<span class="n">approval.xml─┘           │  (multiple) │  │      └─ volumes</span>
<span class="n">                         └──────┬──────┘  │</span>
<span class="n">                                │         │</span>
<span class="n">                            merge         │      Ansible</span>
<span class="n">                                │         │      ├─ playbook</span>
<span class="n">                         ┌──────▼──────┐  │      ├─ roles</span>
<span class="n">                         │   intent.   │──┴────&gt; │   ├─ tasks</span>
<span class="n">                         │    yaml     │         │   └─ defaults</span>
<span class="n">                         │  (unified)  │         └─ inventory</span>
<span class="n">                         └─────────────┘</span>
</code></pre></div>

<p>The intent layer acts as a <strong>translation hub</strong>: multiple VMware sources → unified intent → multiple OpenShift formats.</p>
<h2 id="architecture-principles">Architecture Principles</h2>
<h3 id="1-safety-first">1. Safety First</h3>
<p><strong>No Destructive Operations</strong>
- All operations are read-only on source systems
- No live VMware/vCenter access in v1
- No automatic execution of generated artifacts</p>
<p><strong>Explicit User Control</strong>
- Every step requires explicit command
- Clear separation between analysis and generation
- Dry-run validation before deployment</p>
<p><strong>Transparent Decision Making</strong>
- All AI assumptions logged to <code>intent/assumptions.md</code>
- All conflicts reported in <code>intent/conflicts.md</code>
- All intermediate artifacts written to disk</p>
<h3 id="2-modularity">2. Modularity</h3>
<p><strong>Component Independence</strong>
- Each module has single responsibility
- Clean interfaces between components
- Swappable LLM providers</p>
<p><strong>Plugin Architecture</strong>
- Easy to add new source types (future: Terraform, ARM templates)
- Easy to add new target platforms (future: AWS, Azure)
- Easy to add new LLM providers</p>
<h3 id="3-filesystem-as-database">3. Filesystem as Database</h3>
<p><strong>Workspace-Centric Design</strong>
- All state stored in filesystem
- No external database required
- Easy to version control</p>
<p><strong>Immutable Inputs</strong>
- Imported files never modified
- Original sources preserved
- SHA-256 hashing for integrity</p>
<p><strong>Auditable Outputs</strong>
- Every transformation saved to disk
- Complete audit trail
- Reproducible results</p>
<h3 id="4-ai-as-assistant-not-authority">4. AI as Assistant, Not Authority</h3>
<p><strong>Human in the Loop</strong>
- AI suggestions, human decisions
- Manual editing always available
- Validation before generation</p>
<p><strong>Graceful Degradation</strong>
- Works without AI (template mode)
- Falls back to mock provider if API unavailable
- Clear error messages</p>
<h2 id="component-architecture">Component Architecture</h2>
<h3 id="cli-layer">CLI Layer</h3>
<p><strong>Technology</strong>: Typer (Python CLI framework)</p>
<p><strong>Responsibilities</strong>:
- Parse command-line arguments
- Manage workspace context
- Orchestrate workflow steps
- Display results to user</p>
<p><strong>Key Files</strong>:
- <code>ops_translate/cli.py</code> - All CLI commands</p>
<p><strong>Design Patterns</strong>:
- Command pattern for each CLI command
- Dependency injection for workspace path
- Rich output formatting</p>
<h3 id="import-module">Import Module</h3>
<p><strong>Purpose</strong>: Safely copy source files into workspace.</p>
<p><strong>Flow</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">import_file</span><span class="p">(</span><span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">workspace</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
    <span class="mf">1.</span> <span class="n">Validate</span> <span class="n">source_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;powercli&#39;</span><span class="p">,</span> <span class="s1">&#39;vrealize&#39;</span><span class="p">]</span>
    <span class="mf">2.</span> <span class="n">Check</span> <span class="n">file</span> <span class="n">exists</span> <span class="ow">and</span> <span class="ow">is</span> <span class="n">readable</span>
    <span class="mf">3.</span> <span class="n">Compute</span> <span class="n">SHA</span><span class="o">-</span><span class="mi">256</span> <span class="nb">hash</span>
    <span class="mf">4.</span> <span class="n">Copy</span> <span class="n">to</span> <span class="nb">input</span><span class="o">/</span><span class="p">{</span><span class="n">source_type</span><span class="p">}</span><span class="o">/</span>
    <span class="mf">5.</span> <span class="n">Log</span> <span class="n">metadata</span>
    <span class="mf">6.</span> <span class="n">Return</span> <span class="n">status</span>
</code></pre></div>

<p><strong>Metadata Logged</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;provision.ps1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;source_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;powercli&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;sha256&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abc123...&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;imported_at&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-01-15T10:30:00Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;original_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/path/to/provision.ps1&quot;</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="summarize-module">Summarize Module</h3>
<p><strong>Purpose</strong>: Detect automation patterns without AI.</p>
<p><strong>Architecture</strong>:</p>
<div class="codehilite"><pre><span></span><code>summarize/
├── __init__.py
├── powercli.py      # PowerCLI pattern detection
└── vrealize.py      # vRealize pattern detection
</code></pre></div>

<p><strong>PowerCLI Pattern Detection</strong> (<code>powercli.py</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">summarize</span><span class="p">(</span><span class="n">script_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">script_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>

    <span class="c1"># Extract parameters</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">extract_parameters</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="c1"># Detect patterns</span>
    <span class="n">has_env_branching</span> <span class="o">=</span> <span class="n">detect_environment_branching</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="n">has_tagging</span> <span class="o">=</span> <span class="n">detect_tagging</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="n">has_network_storage</span> <span class="o">=</span> <span class="n">detect_network_storage</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="c1"># Format markdown summary</span>
    <span class="k">return</span> <span class="n">format_summary</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">has_env_branching</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div>

<p><strong>Pattern Detection Methods</strong>:
- <strong>Parameters</strong>: Regex matching <code>param(...)</code> blocks
- <strong>Environment Branching</strong>: Look for <code>ValidateSet</code>, <code>if $env</code>, etc.
- <strong>Tagging</strong>: Look for <code>New-TagAssignment</code>, <code>.Tags</code>, <code>@{...}</code>
- <strong>Network/Storage</strong>: Look for network/storage cmdlets and variables</p>
<p><strong>vRealize Pattern Detection</strong> (<code>vrealize.py</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">summarize</span><span class="p">(</span><span class="n">workflow_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">workflow_path</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>

    <span class="c1"># Parse XML structure</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">extract_inputs</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">extract_outputs</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="c1"># Detect patterns</span>
    <span class="n">has_approval</span> <span class="o">=</span> <span class="n">detect_approval</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">has_env_branching</span> <span class="o">=</span> <span class="n">detect_environment_branching</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">format_summary</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div>

<p><strong>XML Pattern Detection</strong>:
- <strong>Inputs/Outputs</strong>: Parse <code>&lt;input&gt;</code> and <code>&lt;output&gt;</code> elements
- <strong>Approval</strong>: Look for approval decision nodes
- <strong>Branching</strong>: Look for decision/conditional elements</p>
<h3 id="extract-module">Extract Module</h3>
<p><strong>Purpose</strong>: Convert source automation to operational intent using AI or templates.</p>
<p><strong>Flow</strong>:</p>
<div class="codehilite"><pre><span></span><code>┌──────────────┐
│ Source File  │
│ (PS1 or XML) │
└──────┬───────┘
       │
       ▼
┌──────────────────┐
│  Read Content    │
└──────┬───────────┘
       │
       ▼
    ┌──────┐
    │ AI?  │───No──▶┌────────────────┐
    └──┬───┘        │ Template-Based │
       │ Yes        │   Extraction   │
       ▼            └───────┬────────┘
┌──────────────────┐        │
│  Build Prompt    │        │
└──────┬───────────┘        │
       │                    │
       ▼                    │
┌──────────────────┐        │
│  Call LLM API    │        │
└──────┬───────────┘        │
       │                    │
       ▼                    ▼
┌────────────────────────────┐
│   Parse Intent YAML        │
└──────┬─────────────────────┘
       │
       ▼
┌────────────────────────────┐
│  Save to intent/*.yaml     │
│  Log assumptions to        │
│  intent/assumptions.md     │
└────────────────────────────┘
</code></pre></div>

<p><strong>Prompt Construction</strong>:</p>
<p>The prompts are stored in <code>prompts/</code> directory:
- <code>intent_extract_powercli.md</code> - PowerCLI extraction
- <code>intent_extract_vrealize.md</code> - vRealize extraction
- <code>generate_artifacts.md</code> - Artifact generation</p>
<p><strong>Example Prompt Structure</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="gh"># Role</span>
You are an expert in VMware automation and OpenShift migration.

<span class="gh"># Task</span>
Extract operational intent from this PowerCLI script.

<span class="gh"># Input</span>
{script_content}

<span class="gh"># Output Format</span>
Produce YAML following this schema:
{schema}

<span class="gh"># Guidelines</span>
<span class="k">-</span><span class="w"> </span>Preserve all input parameters
<span class="k">-</span><span class="w"> </span>Detect environment-specific logic
<span class="k">-</span><span class="w"> </span>Log any assumptions in assumptions section
</code></pre></div>

<p><strong>AI Response Parsing</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_llm_response</span><span class="p">(</span><span class="n">response</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="c1"># Extract YAML from markdown code blocks</span>
    <span class="n">yaml_content</span> <span class="o">=</span> <span class="n">extract_yaml_from_markdown</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="c1"># Parse YAML</span>
    <span class="n">intent</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">yaml_content</span><span class="p">)</span>

    <span class="c1"># Validate against schema</span>
    <span class="n">validate_intent_schema</span><span class="p">(</span><span class="n">intent</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">intent</span>
</code></pre></div>

<h3 id="merge-module">Merge Module</h3>
<p><strong>Purpose</strong>: Combine multiple intent sources into unified intent.</p>
<p><strong>Smart Merging Logic</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">merge_intents</span><span class="p">(</span><span class="n">intents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
    <span class="n">merged</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">conflicts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Merge inputs (combine all unique inputs)</span>
    <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;inputs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge_inputs</span><span class="p">(</span><span class="n">intents</span><span class="p">,</span> <span class="n">conflicts</span><span class="p">)</span>

    <span class="c1"># Merge compute (use maximum values)</span>
    <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;compute&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge_compute_max</span><span class="p">(</span><span class="n">intents</span><span class="p">,</span> <span class="n">conflicts</span><span class="p">)</span>

    <span class="c1"># Merge networking (detect conflicts)</span>
    <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;networking&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge_networking</span><span class="p">(</span><span class="n">intents</span><span class="p">,</span> <span class="n">conflicts</span><span class="p">)</span>

    <span class="c1"># Merge governance (most restrictive wins)</span>
    <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;governance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge_governance_strict</span><span class="p">(</span><span class="n">intents</span><span class="p">,</span> <span class="n">conflicts</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">merged</span><span class="p">,</span> <span class="n">conflicts</span>
</code></pre></div>

<p><strong>Merge Strategies</strong>:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Strategy</th>
<th>Rationale</th>
</tr>
</thead>
<tbody>
<tr>
<td>inputs</td>
<td>Union</td>
<td>Combine all unique inputs</td>
</tr>
<tr>
<td>compute.cpu_count</td>
<td>Maximum</td>
<td>Provision for highest need</td>
</tr>
<tr>
<td>compute.memory_gb</td>
<td>Maximum</td>
<td>Provision for highest need</td>
</tr>
<tr>
<td>governance.approval_required</td>
<td>OR (any true → true)</td>
<td>Most restrictive</td>
</tr>
<tr>
<td>governance.quotas</td>
<td>Minimum</td>
<td>Most restrictive</td>
</tr>
<tr>
<td>networking.*</td>
<td>Conflict on difference</td>
<td>Needs manual resolution</td>
</tr>
<tr>
<td>storage.*</td>
<td>Conflict on difference</td>
<td>Needs manual resolution</td>
</tr>
</tbody>
</table>
<p><strong>Conflict Detection</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">detect_conflicts</span><span class="p">(</span><span class="n">intent1</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">intent2</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">conflicts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Network mapping conflicts</span>
    <span class="k">if</span> <span class="n">intent1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;networking&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;network&#39;</span><span class="p">)</span> <span class="o">!=</span> \
       <span class="n">intent2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;networking&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;network&#39;</span><span class="p">):</span>
        <span class="n">conflicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;Network mapping differs: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">intent1</span><span class="p">[</span><span class="s1">&#39;networking&#39;</span><span class="p">][</span><span class="s1">&#39;network&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> vs &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">intent2</span><span class="p">[</span><span class="s1">&#39;networking&#39;</span><span class="p">][</span><span class="s1">&#39;network&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Approval requirement conflicts</span>
    <span class="k">if</span> <span class="n">intent1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;governance&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;approval_required&#39;</span><span class="p">)</span> <span class="o">!=</span> \
       <span class="n">intent2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;governance&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;approval_required&#39;</span><span class="p">):</span>
        <span class="n">conflicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;Approval requirement mismatch: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">intent1</span><span class="p">[</span><span class="s1">&#39;governance&#39;</span><span class="p">][</span><span class="s1">&#39;approval_required&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> vs &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">intent2</span><span class="p">[</span><span class="s1">&#39;governance&#39;</span><span class="p">][</span><span class="s1">&#39;approval_required&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">conflicts</span>
</code></pre></div>

<h3 id="validate-module">Validate Module</h3>
<p><strong>Purpose</strong>: Validate intent and generated artifacts.</p>
<p><strong>Validation Pipeline</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_intent</span><span class="p">(</span><span class="n">intent_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># YAML syntax check</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">intent_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">intent</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;YAML syntax error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="c1"># Schema version check</span>
    <span class="k">if</span> <span class="n">intent</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;schema_version&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Invalid or missing schema_version&quot;</span><span class="p">)</span>

    <span class="c1"># Required fields</span>
    <span class="n">required</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;workflow_name&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">required</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">intent</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required field: </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Validate inputs</span>
    <span class="k">if</span> <span class="s1">&#39;inputs&#39;</span> <span class="ow">in</span> <span class="n">intent</span><span class="p">:</span>
        <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">intent</span><span class="p">[</span><span class="s1">&#39;inputs&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Input missing &#39;name&#39; field&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">errors</span>
</code></pre></div>

<h3 id="generate-module">Generate Module</h3>
<p><strong>Purpose</strong>: Create Ansible playbooks, roles, and KubeVirt manifests from intent or directly from PowerCLI/vRO workflows.</p>
<p><strong>Two Generation Paths</strong>:
1. <strong>Intent-based generation</strong> - Transforms normalized intent.yaml to Ansible/KubeVirt
2. <strong>Direct translation</strong> - Uses Translate Module for PowerCLI/vRO → Ansible tasks</p>
<p><strong>Architecture</strong>:</p>
<div class="codehilite"><pre><span></span><code>generate/
├── __init__.py
├── generator.py            # Main generation orchestrator
├── ansible.py              # Ansible-specific generation
├── ansible_project.py      # Role skeleton and structure generation
├── workflow_to_ansible.py  # AnsibleTask dataclass and YAML generation
├── kubevirt.py             # KubeVirt-specific generation
├── networkpolicy.py        # NetworkPolicy generation
├── network_attachment.py   # NetworkAttachmentDefinition generation
└── eda_rulebook.py         # Event-Driven Ansible rulebook generation
</code></pre></div>

<p><strong>Note</strong>: Role generation for PowerCLI and vRO workflows uses the Translate Module (see below) to produce deterministic Ansible tasks rather than LLM-generated skeletons.</p>
<p><strong>Generation Flow</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_all</span><span class="p">(</span>
    <span class="n">workspace</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">profile_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">use_ai</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Load intent</span>
    <span class="n">intent</span> <span class="o">=</span> <span class="n">load_intent</span><span class="p">(</span><span class="n">workspace</span> <span class="o">/</span> <span class="s1">&#39;intent&#39;</span> <span class="o">/</span> <span class="s1">&#39;intent.yaml&#39;</span><span class="p">)</span>

    <span class="c1"># Load profile</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">load_config</span><span class="p">(</span><span class="n">workspace</span> <span class="o">/</span> <span class="s1">&#39;ops-translate.yaml&#39;</span><span class="p">)</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;profiles&#39;</span><span class="p">][</span><span class="n">profile_name</span><span class="p">]</span>

    <span class="c1"># Generate KubeVirt manifest</span>
    <span class="n">vm_yaml</span> <span class="o">=</span> <span class="n">generate_kubevirt</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">use_ai</span><span class="p">)</span>
    <span class="n">write_file</span><span class="p">(</span><span class="n">workspace</span> <span class="o">/</span> <span class="s1">&#39;output&#39;</span> <span class="o">/</span> <span class="s1">&#39;kubevirt&#39;</span> <span class="o">/</span> <span class="s1">&#39;vm.yaml&#39;</span><span class="p">,</span> <span class="n">vm_yaml</span><span class="p">)</span>

    <span class="c1"># Generate Ansible playbook</span>
    <span class="n">playbook</span> <span class="o">=</span> <span class="n">generate_ansible</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="n">profile</span><span class="p">,</span> <span class="n">use_ai</span><span class="p">)</span>
    <span class="n">write_ansible_structure</span><span class="p">(</span><span class="n">workspace</span> <span class="o">/</span> <span class="s1">&#39;output&#39;</span> <span class="o">/</span> <span class="s1">&#39;ansible&#39;</span><span class="p">,</span> <span class="n">playbook</span><span class="p">)</span>

    <span class="c1"># Generate README</span>
    <span class="n">readme</span> <span class="o">=</span> <span class="n">generate_readme</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>
    <span class="n">write_file</span><span class="p">(</span><span class="n">workspace</span> <span class="o">/</span> <span class="s1">&#39;output&#39;</span> <span class="o">/</span> <span class="s1">&#39;README.md&#39;</span><span class="p">,</span> <span class="n">readme</span><span class="p">)</span>
</code></pre></div>

<p><strong>KubeVirt Generation</strong> (<code>kubevirt.py</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_kubevirt</span><span class="p">(</span>
    <span class="n">intent</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">profile</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">use_ai</span><span class="p">:</span> <span class="nb">bool</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">use_ai</span><span class="p">:</span>
        <span class="c1"># Use LLM to generate</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">build_kubevirt_prompt</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>
        <span class="n">llm</span> <span class="o">=</span> <span class="n">get_provider</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">yaml_content</span> <span class="o">=</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Use template</span>
        <span class="n">yaml_content</span> <span class="o">=</span> <span class="n">render_kubevirt_template</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">yaml_content</span>
</code></pre></div>

<p><strong>Template Example</strong> (simplified):</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">render_kubevirt_template</span><span class="p">(</span><span class="n">intent</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">vm_name</span> <span class="o">=</span> <span class="n">intent</span><span class="p">[</span><span class="s1">&#39;inputs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">cpu</span> <span class="o">=</span> <span class="n">intent</span><span class="p">[</span><span class="s1">&#39;compute&#39;</span><span class="p">][</span><span class="s1">&#39;cpu_count&#39;</span><span class="p">]</span>
    <span class="n">memory</span> <span class="o">=</span> <span class="n">intent</span><span class="p">[</span><span class="s1">&#39;compute&#39;</span><span class="p">][</span><span class="s1">&#39;memory_gb&#39;</span><span class="p">]</span>
    <span class="n">namespace</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;default_namespace&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">apiVersion: kubevirt.io/v1</span>
<span class="s2">kind: VirtualMachine</span>
<span class="s2">metadata:</span>
<span class="s2">  name: </span><span class="si">{</span><span class="n">vm_name</span><span class="si">}</span>
<span class="s2">  namespace: </span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span>
<span class="s2">spec:</span>
<span class="s2">  running: false</span>
<span class="s2">  template:</span>
<span class="s2">    spec:</span>
<span class="s2">      domain:</span>
<span class="s2">        cpu:</span>
<span class="s2">          cores: </span><span class="si">{</span><span class="n">cpu</span><span class="si">}</span>
<span class="s2">        resources:</span>
<span class="s2">          requests:</span>
<span class="s2">            memory: </span><span class="si">{</span><span class="n">memory</span><span class="si">}</span><span class="s2">Gi</span>
<span class="s2">        devices:</span>
<span class="s2">          disks:</span>
<span class="s2">            - name: rootdisk</span>
<span class="s2">              disk:</span>
<span class="s2">                bus: virtio</span>
<span class="s2">      volumes:</span>
<span class="s2">        - name: rootdisk</span>
<span class="s2">          dataVolume:</span>
<span class="s2">            name: </span><span class="si">{</span><span class="n">vm_name</span><span class="si">}</span><span class="s2">-rootdisk</span>
<span class="s2">&quot;&quot;&quot;</span>
</code></pre></div>

<p><strong>Ansible Generation</strong> (<code>ansible.py</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_ansible</span><span class="p">(</span>
    <span class="n">intent</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">profile</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">use_ai</span><span class="p">:</span> <span class="nb">bool</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">use_ai</span><span class="p">:</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">build_ansible_prompt</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>
        <span class="n">llm</span> <span class="o">=</span> <span class="n">get_provider</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">llm</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;playbook&#39;</span><span class="p">:</span> <span class="n">render_playbook_template</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="n">profile</span><span class="p">),</span>
            <span class="s1">&#39;tasks&#39;</span><span class="p">:</span> <span class="n">render_tasks_template</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="n">profile</span><span class="p">),</span>
            <span class="s1">&#39;defaults&#39;</span><span class="p">:</span> <span class="n">render_defaults_template</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span>
        <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">write_ansible_structure</span><span class="p">(</span><span class="n">base_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="c1"># Write main playbook</span>
    <span class="n">write_file</span><span class="p">(</span><span class="n">base_path</span> <span class="o">/</span> <span class="s1">&#39;site.yml&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">[</span><span class="s1">&#39;playbook&#39;</span><span class="p">])</span>

    <span class="c1"># Write role structure</span>
    <span class="n">role_path</span> <span class="o">=</span> <span class="n">base_path</span> <span class="o">/</span> <span class="s1">&#39;roles&#39;</span> <span class="o">/</span> <span class="s1">&#39;provision_vm&#39;</span>
    <span class="n">write_file</span><span class="p">(</span><span class="n">role_path</span> <span class="o">/</span> <span class="s1">&#39;tasks&#39;</span> <span class="o">/</span> <span class="s1">&#39;main.yml&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">[</span><span class="s1">&#39;tasks&#39;</span><span class="p">])</span>
    <span class="n">write_file</span><span class="p">(</span><span class="n">role_path</span> <span class="o">/</span> <span class="s1">&#39;defaults&#39;</span> <span class="o">/</span> <span class="s1">&#39;main.yml&#39;</span><span class="p">,</span> <span class="n">content</span><span class="p">[</span><span class="s1">&#39;defaults&#39;</span><span class="p">])</span>
</code></pre></div>

<h3 id="translate-module">Translate Module</h3>
<p><strong>Purpose</strong>: Deterministically translate PowerCLI scripts and vRealize workflows into Ansible tasks without LLM intervention.</p>
<p><strong>Key Distinction</strong>: The Translate Module provides <strong>deterministic, mapping-based translation</strong> for supported cmdlets and workflow patterns, while the Extract/Generate modules use <strong>LLM-based transformation</strong> for complex scenarios.</p>
<p><strong>Architecture</strong>:</p>
<div class="codehilite"><pre><span></span><code>translate/
├── __init__.py
├── powercli_script.py             # PowerCLI → Ansible translation
├── powercli_cmdlet_mappings.yaml  # Cmdlet mapping definitions
├── vrealize_workflow.py           # vRO workflow → Ansible translation
└── vro_integration_mappings.yaml  # vRO integration mappings
</code></pre></div>

<p><strong>Translation Flow</strong>:</p>
<div class="codehilite"><pre><span></span><code>PowerCLI Script          vRealize Workflow
     │                        │
     ├─ Parser ───────────────┤
     │                        │
     ├─ Statement/Item List   │
     │  (categorized)         │
     │                        │
     ├─ Translator ───────────┤
     │  (mapping-based)       │
     │                        │
     └─ AnsibleTask objects ──┘
              │
              ├─ YAML Generator
              │
              └─ tasks/main.yml
</code></pre></div>

<p><strong>PowerCLI Translation</strong> (<code>powercli_script.py</code>):</p>
<p><strong>Components</strong>:</p>
<ol>
<li><strong>PowerCLIStatement</strong> - Structured representation of parsed PowerShell:</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PowerCLIStatement</span><span class="p">:</span>
    <span class="n">line_number</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">raw_text</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">statement_type</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># param | assignment | cmdlet | control_flow | comment</span>
    <span class="n">category</span><span class="p">:</span> <span class="nb">str</span>        <span class="c1"># context | lookup | mutation | integration | gate</span>
    <span class="n">cmdlet</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="n">integration_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>  <span class="c1"># tagging | snapshot | network | nsx</span>
</code></pre></div>

<ol>
<li><strong>PowerCLIScriptParser</strong> - Parses <code>.ps1</code> files sequentially:</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PowerCLIScriptParser</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">script_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">PowerCLIStatement</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse PowerCLI script into categorized statements.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_categorize_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmt</span><span class="p">:</span> <span class="n">PowerCLIStatement</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Categorize as context/lookup/mutation/integration/gate.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_detect_integration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmt</span><span class="p">:</span> <span class="n">PowerCLIStatement</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect integration type (tagging/snapshot/network).&quot;&quot;&quot;</span>
</code></pre></div>

<ol>
<li><strong>PowerShellToAnsibleTranslator</strong> - Maps cmdlets to Ansible tasks:</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PowerShellToAnsibleTranslator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">ProfileSchema</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">profile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdlet_mappings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_cmdlet_mappings</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">translate_statements</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">statements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PowerCLIStatement</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">AnsibleTask</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Translate parsed statements to Ansible tasks.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_translate_cmdlet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmt</span><span class="p">:</span> <span class="n">PowerCLIStatement</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnsibleTask</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Map cmdlet to Ansible module using mappings.yaml.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_translate_integration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmt</span><span class="p">:</span> <span class="n">PowerCLIStatement</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnsibleTask</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate adapter call or BLOCKED stub based on profile.&quot;&quot;&quot;</span>
</code></pre></div>

<p><strong>Statement Categories</strong>:</p>
<ul>
<li><strong>context</strong> - Environment setup: <code>$Network = "dev-network"</code> → <code>set_fact</code></li>
<li><strong>lookup</strong> - Read operations: <code>Get-VM</code> → <code>k8s_info</code></li>
<li><strong>mutation</strong> - State changes: <code>New-VM</code>, <code>Start-VM</code> → <code>kubevirt_vm</code></li>
<li><strong>integration</strong> - External systems: <code>New-TagAssignment</code> → labels, <code>New-Snapshot</code> → VolumeSnapshot</li>
<li><strong>gate</strong> - Validations: <code>if ($x -gt 16) { throw }</code> → <code>assert</code></li>
</ul>
<p><strong>Cmdlet Mappings</strong> (<code>powercli_cmdlet_mappings.yaml</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="nt">vm_operations</span><span class="p">:</span>
<span class="w">  </span><span class="nt">new_vm</span><span class="p">:</span>
<span class="w">    </span><span class="nt">match</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cmdlet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">New-VM</span>
<span class="w">    </span><span class="nt">ansible</span><span class="p">:</span>
<span class="w">      </span><span class="nt">module</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubevirt.core.kubevirt_vm</span>
<span class="w">      </span><span class="nt">params</span><span class="p">:</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{Name}&quot;</span>
<span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">target_namespace</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">cpu_cores</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{NumCpu}&quot;</span>
<span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{MemoryGB}Gi&quot;</span>
<span class="w">    </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mutation</span>
<span class="w">    </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">mutation</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">vm</span><span class="p p-Indicator">]</span>

<span class="nt">tagging</span><span class="p">:</span>
<span class="w">  </span><span class="nt">new_tag_assignment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">match</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cmdlet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">New-TagAssignment</span>
<span class="w">    </span><span class="nt">ansible</span><span class="p">:</span>
<span class="w">      </span><span class="nt">module</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.core.k8s</span>
<span class="w">      </span><span class="nt">params</span><span class="p">:</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patched</span>
<span class="w">        </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VirtualMachine</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{Entity}&quot;</span>
<span class="w">        </span><span class="nt">definition</span><span class="p">:</span>
<span class="w">          </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">            </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">              </span><span class="s">&quot;{tag_key}&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;{tag_value}&quot;</span>
<span class="w">    </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">integration</span>
<span class="w">    </span><span class="nt">integration_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tagging</span>
</code></pre></div>

<p><strong>Parameter Substitution</strong>:
- <code>{ParamName}</code> - Replaced with cmdlet parameter value
- <code>{ParamName}Gi</code> - Preserved suffix (e.g., <code>{MemoryGB}Gi</code> → <code>"8Gi"</code>)
- PowerShell variables (<code>$VMName</code>) → Jinja2 templates (<code>{{ vmname }}</code>)</p>
<p><strong>vRealize Workflow Translation</strong> (<code>vrealize_workflow.py</code>):</p>
<p><strong>Components</strong>:</p>
<ol>
<li><strong>WorkflowParser</strong> - Parses vRO XML workflows:</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">WorkflowParser</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xml_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">WorkflowItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse vRO workflow XML into execution-ordered items.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_topological_sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">WorkflowItem</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">WorkflowItem</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sort workflow items by execution dependencies.&quot;&quot;&quot;</span>
</code></pre></div>

<ol>
<li><strong>JavaScriptToAnsibleTranslator</strong> - Translates scriptable tasks:</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">JavaScriptToAnsibleTranslator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">translate_items</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">WorkflowItem</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">AnsibleTask</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Translate workflow items to Ansible tasks.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_translate_scriptable_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">WorkflowItem</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnsibleTask</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert JavaScript code to equivalent Ansible task.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_detect_integration_calls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect NSX, ServiceNow, ITSM integration patterns.&quot;&quot;&quot;</span>
</code></pre></div>

<p><strong>Integration Detection</strong> - Allowlist-based pattern matching:</p>
<div class="codehilite"><pre><span></span><code><span class="n">INTEGRATION_PATTERNS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;nsx&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;nsxClient&quot;</span><span class="p">,</span> <span class="s2">&quot;logicalSwitch&quot;</span><span class="p">,</span> <span class="s2">&quot;logicalRouter&quot;</span><span class="p">],</span>
    <span class="s2">&quot;servicenow&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;RESTHost&quot;</span><span class="p">,</span> <span class="s2">&quot;sys_id&quot;</span><span class="p">,</span> <span class="s2">&quot;incident&quot;</span><span class="p">],</span>
    <span class="s2">&quot;itsm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ticketCreate&quot;</span><span class="p">,</span> <span class="s2">&quot;approvalRequest&quot;</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Profile-Driven Decisions</strong>:</p>
<p>When the translator encounters integrations that require profile configuration:</p>
<ol>
<li><strong>Network Adapters</strong> (<code>New-NetworkAdapter</code>):</li>
<li><strong>With profile.network_security</strong>: Generate NAD adapter call</li>
<li>
<p><strong>Without profile</strong>: Generate BLOCKED stub with guidance</p>
</li>
<li>
<p><strong>Approval Gates</strong> (vRO approval workflows):</p>
</li>
<li><strong>With profile.approval.model</strong>: Generate AAP approval adapter</li>
<li>
<p><strong>Without profile</strong>: Generate BLOCKED stub</p>
</li>
<li>
<p><strong>Storage Tiers</strong> (<code>$Datastore = "prod-ceph-rbd"</code>):</p>
</li>
<li><strong>With profile.storage_tiers</strong>: Map to storageClassName</li>
<li><strong>Without profile</strong>: Use default storage class</li>
</ol>
<p><strong>BLOCKED Stub Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BLOCKED - Network adapter creation requires configuration</span>
<span class="w">  </span><span class="nt">ansible.builtin.fail</span><span class="p">:</span>
<span class="w">    </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">BLOCKED: Network Adapter Creation</span>

<span class="w">      </span><span class="no">Evidence: New-NetworkAdapter -NetworkName &quot;prod-network&quot;</span>

<span class="w">      </span><span class="no">TO FIX: Add to profile.yml:</span>
<span class="w">        </span><span class="no">network_security:</span>
<span class="w">          </span><span class="no">model: networkpolicy</span>

<span class="w">      </span><span class="no">Then re-run: ops-translate generate --profile &lt;profile&gt;</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">blocked</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">network</span><span class="p p-Indicator">]</span>
</code></pre></div>

<p><strong>Integration with Role Generation</strong>:</p>
<p>The Translate Module is called by <code>ansible_project.py</code> during role generation:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_generate_powercli_role</span><span class="p">(</span>
    <span class="n">workflow</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">source_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">project_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">profile</span><span class="p">:</span> <span class="n">ProfileSchema</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">ops_translate.translate.powercli_script</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
        <span class="n">PowerCLIScriptParser</span><span class="p">,</span>
        <span class="n">PowerShellToAnsibleTranslator</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Parse script</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">PowerCLIScriptParser</span><span class="p">()</span>
    <span class="n">statements</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_file</span><span class="p">(</span><span class="n">source_file</span><span class="p">)</span>

    <span class="c1"># Translate to tasks</span>
    <span class="n">translator</span> <span class="o">=</span> <span class="n">PowerShellToAnsibleTranslator</span><span class="p">(</span><span class="n">profile</span><span class="o">=</span><span class="n">profile</span><span class="p">)</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="n">translator</span><span class="o">.</span><span class="n">translate_statements</span><span class="p">(</span><span class="n">statements</span><span class="p">)</span>

    <span class="c1"># Generate YAML</span>
    <span class="n">tasks_yaml</span> <span class="o">=</span> <span class="n">generate_ansible_yaml</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>

    <span class="c1"># Write to role structure</span>
    <span class="p">(</span><span class="n">role_dir</span> <span class="o">/</span> <span class="s2">&quot;tasks&quot;</span> <span class="o">/</span> <span class="s2">&quot;main.yml&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">tasks_yaml</span><span class="p">)</span>
</code></pre></div>

<p><strong>Translation vs Intent Extraction</strong>:</p>
<table>
<thead>
<tr>
<th>Approach</th>
<th>Use Case</th>
<th>Determinism</th>
<th>Profile-Aware</th>
<th>Coverage</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Translate Module</strong></td>
<td>Supported cmdlets/workflows</td>
<td>✅ Deterministic</td>
<td>✅ Yes</td>
<td>Common patterns</td>
</tr>
<tr>
<td><strong>Extract + Generate</strong></td>
<td>Complex/custom scenarios</td>
<td>⚠️ LLM-based</td>
<td>✅ Yes</td>
<td>All inputs</td>
</tr>
</tbody>
</table>
<p><strong>When to Use Each</strong>:</p>
<ul>
<li><strong>Use Translate Module</strong>: PowerCLI scripts with standard cmdlets (<code>New-VM</code>, <code>Start-VM</code>, <code>New-TagAssignment</code>)</li>
<li><strong>Use Intent Extraction</strong>: Complex logic, custom functions, multi-source merging</li>
</ul>
<p><strong>Key Benefits</strong>:</p>
<ol>
<li><strong>Deterministic Output</strong> - Same input always produces identical output</li>
<li><strong>No LLM Required</strong> - Fast, offline translation for common patterns</li>
<li><strong>Profile-Driven</strong> - Adapts to target environment configuration</li>
<li><strong>Transparent</strong> - Clear mapping files, no "black box" translation</li>
<li><strong>Extensible</strong> - Add new cmdlet mappings via YAML</li>
</ol>
<h2 id="data-flow">Data Flow</h2>
<h3 id="complete-pipeline">Complete Pipeline</h3>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">IMPORT</span><span class="w"> </span><span class="n">PHASE</span>
<span class="w">   </span><span class="err">┌──────────────┐</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">PowerCLI</span><span class="mf">.</span><span class="n">ps1</span><span class="w"> </span><span class="err">│──┐</span>
<span class="w">   </span><span class="err">└──────────────┘</span><span class="w">  </span><span class="err">│</span>
<span class="w">   </span><span class="err">┌──────────────┐</span><span class="w">  </span><span class="err">│</span><span class="w">     </span><span class="err">┌────────────────┐</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">Workflow</span><span class="mf">.</span><span class="n">xml</span><span class="w"> </span><span class="err">│──┼────▶│</span><span class="w"> </span><span class="kr">input</span><span class="o">/</span><span class="w"> </span><span class="n">folder</span><span class="w">  </span><span class="err">│</span>
<span class="w">   </span><span class="err">└──────────────┘</span><span class="w">  </span><span class="err">│</span><span class="w">     </span><span class="err">└────────────────┘</span>
<span class="w">   </span><span class="err">┌──────────────┐</span><span class="w">  </span><span class="err">│</span>
<span class="w">   </span><span class="err">│</span><span class="w">  </span><span class="n">Script2</span><span class="mf">.</span><span class="n">ps1</span><span class="w"> </span><span class="err">│──┘</span>
<span class="w">   </span><span class="err">└──────────────┘</span>

<span class="mf">2.</span><span class="w"> </span><span class="n">SUMMARIZE</span><span class="w"> </span><span class="n">PHASE</span><span class="w"> </span><span class="p">(</span><span class="n">Optional</span><span class="p">)</span>
<span class="w">   </span><span class="err">┌────────────────┐</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="kr">input</span><span class="o">/</span><span class="w"> </span><span class="n">folder</span><span class="w">  </span><span class="err">│</span>
<span class="w">   </span><span class="err">└────────┬───────┘</span>
<span class="w">            </span><span class="err">│</span>
<span class="w">            </span><span class="err">▼</span>
<span class="w">   </span><span class="err">┌────────────────────┐</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">Pattern</span><span class="w"> </span><span class="n">Detection</span><span class="w">  </span><span class="err">│</span>
<span class="w">   </span><span class="err">└────────┬───────────┘</span>
<span class="w">            </span><span class="err">│</span>
<span class="w">            </span><span class="err">▼</span>
<span class="w">   </span><span class="err">┌────────────────────┐</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nb">int</span><span class="n">ent</span><span class="o">/</span><span class="n">summary</span><span class="mf">.</span><span class="n">md</span><span class="w">  </span><span class="err">│</span>
<span class="w">   </span><span class="err">└────────────────────┘</span>

<span class="mf">3.</span><span class="w"> </span><span class="n">EXTRACT</span><span class="w"> </span><span class="n">PHASE</span>
<span class="w">   </span><span class="err">┌────────────────┐</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="kr">input</span><span class="o">/</span><span class="w"> </span><span class="n">folder</span><span class="w">  </span><span class="err">│</span>
<span class="w">   </span><span class="err">└────────┬───────┘</span>
<span class="w">            </span><span class="err">│</span>
<span class="w">            </span><span class="err">▼</span>
<span class="w">   </span><span class="err">┌────────────────────┐</span>
<span class="w">   </span><span class="err">│</span><span class="w">  </span><span class="n">LLM</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Templates</span><span class="w">   </span><span class="err">│</span>
<span class="w">   </span><span class="err">└────────┬───────────┘</span>
<span class="w">            </span><span class="err">│</span>
<span class="w">            </span><span class="err">▼</span>
<span class="w">   </span><span class="err">┌────────────────────────────────┐</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nb">int</span><span class="n">ent</span><span class="o">/</span><span class="n">powercli</span><span class="mf">.</span><span class="nb">int</span><span class="n">ent</span><span class="mf">.</span><span class="n">yaml</span><span class="w">    </span><span class="err">│</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nb">int</span><span class="n">ent</span><span class="o">/</span><span class="n">vrealize</span><span class="mf">.</span><span class="nb">int</span><span class="n">ent</span><span class="mf">.</span><span class="n">yaml</span><span class="w">    </span><span class="err">│</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nb">int</span><span class="n">ent</span><span class="o">/</span><span class="n">assumptions</span><span class="mf">.</span><span class="n">md</span><span class="w">          </span><span class="err">│</span>
<span class="w">   </span><span class="err">└────────────────────────────────┘</span>

<span class="mf">4.</span><span class="w"> </span><span class="n">MERGE</span><span class="w"> </span><span class="n">PHASE</span>
<span class="w">   </span><span class="err">┌────────────────────────────────┐</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nb">int</span><span class="n">ent</span><span class="o">/</span><span class="n">powercli</span><span class="mf">.</span><span class="nb">int</span><span class="n">ent</span><span class="mf">.</span><span class="n">yaml</span><span class="w">    </span><span class="err">│</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nb">int</span><span class="n">ent</span><span class="o">/</span><span class="n">vrealize</span><span class="mf">.</span><span class="nb">int</span><span class="n">ent</span><span class="mf">.</span><span class="n">yaml</span><span class="w">    </span><span class="err">│</span>
<span class="w">   </span><span class="err">└────────┬───────────────────────┘</span>
<span class="w">            </span><span class="err">│</span>
<span class="w">            </span><span class="err">▼</span>
<span class="w">   </span><span class="err">┌────────────────────┐</span>
<span class="w">   </span><span class="err">│</span><span class="w">  </span><span class="n">Smart</span><span class="w"> </span><span class="n">Merging</span><span class="w">     </span><span class="err">│</span>
<span class="w">   </span><span class="err">│</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="n">Conflict</span><span class="w"> </span><span class="n">Check</span><span class="w">  </span><span class="err">│</span>
<span class="w">   </span><span class="err">└────────┬───────────┘</span>
<span class="w">            </span><span class="err">│</span>
<span class="w">            </span><span class="err">▼</span>
<span class="w">   </span><span class="err">┌────────────────────────────────┐</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nb">int</span><span class="n">ent</span><span class="o">/</span><span class="nb">int</span><span class="n">ent</span><span class="mf">.</span><span class="n">yaml</span><span class="w">             </span><span class="err">│</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nb">int</span><span class="n">ent</span><span class="o">/</span><span class="n">conflicts</span><span class="mf">.</span><span class="n">md</span><span class="w"> </span><span class="p">(</span><span class="kr">if</span><span class="w"> </span><span class="n">any</span><span class="p">)</span><span class="w">   </span><span class="err">│</span>
<span class="w">   </span><span class="err">└────────────────────────────────┘</span>

<span class="mf">5.</span><span class="w"> </span><span class="n">GENERATE</span><span class="w"> </span><span class="n">PHASE</span>
<span class="w">   </span><span class="err">┌────────────────────┐</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="nb">int</span><span class="n">ent</span><span class="o">/</span><span class="nb">int</span><span class="n">ent</span><span class="mf">.</span><span class="n">yaml</span><span class="w"> </span><span class="err">│</span>
<span class="w">   </span><span class="err">└────────┬───────────┘</span>
<span class="w">            </span><span class="err">│</span>
<span class="w">            </span><span class="err">▼</span>
<span class="w">   </span><span class="err">┌────────────────────────┐</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">LLM</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">Templates</span><span class="w">        </span><span class="err">│</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Profile</span><span class="w"> </span><span class="n">Config</span><span class="w">       </span><span class="err">│</span>
<span class="w">   </span><span class="err">└────────┬───────────────┘</span>
<span class="w">            </span><span class="err">│</span>
<span class="w">            </span><span class="err">▼</span>
<span class="w">   </span><span class="err">┌────────────────────────────────┐</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">output</span><span class="o">/</span><span class="n">kubevirt</span><span class="o">/</span><span class="n">vm</span><span class="mf">.</span><span class="n">yaml</span><span class="w">        </span><span class="err">│</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">output</span><span class="o">/</span><span class="n">ansible</span><span class="o">/</span><span class="n">site</span><span class="mf">.</span><span class="n">yml</span><span class="w">        </span><span class="err">│</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">output</span><span class="o">/</span><span class="n">ansible</span><span class="o">/</span><span class="n">roles</span><span class="o">/</span><span class="mf">...</span><span class="w">       </span><span class="err">│</span>
<span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="n">output</span><span class="o">/</span><span class="kr">READ</span><span class="n">ME</span><span class="mf">.</span><span class="n">md</span><span class="w">               </span><span class="err">│</span>
<span class="w">   </span><span class="err">└────────────────────────────────┘</span>
</code></pre></div>

<h3 id="state-transitions">State Transitions</h3>
<div class="codehilite"><pre><span></span><code><span class="err">┌──────────┐</span>   <span class="kn">import</span><span class="w">   </span><span class="err">┌──────────┐</span>
<span class="err">│</span> <span class="n">NO</span> <span class="n">FILES</span> <span class="err">│──────────▶</span> <span class="err">│</span> <span class="n">IMPORTED</span> <span class="err">│</span>
<span class="err">└──────────┘</span>            <span class="err">└────┬─────┘</span>
                             <span class="err">│</span> <span class="n">extract</span>
                             <span class="err">▼</span>
                        <span class="err">┌──────────┐</span>
                        <span class="err">│</span> <span class="n">EXTRACTED</span><span class="err">│</span>
                        <span class="err">└────┬─────┘</span>
                             <span class="err">│</span> <span class="n">merge</span>
                             <span class="err">▼</span>
                        <span class="err">┌──────────┐</span>
                        <span class="err">│</span>  <span class="n">MERGED</span>  <span class="err">│</span>
                        <span class="err">└────┬─────┘</span>
                             <span class="err">│</span> <span class="n">generate</span>
                             <span class="err">▼</span>
                        <span class="err">┌──────────┐</span>
                        <span class="err">│</span><span class="n">GENERATED</span> <span class="err">│</span>
                        <span class="err">└──────────┘</span>
</code></pre></div>

<p>Each state is represented by files on disk:
- <strong>IMPORTED</strong>: Files in <code>input/</code>
- <strong>EXTRACTED</strong>: Files in <code>intent/*.intent.yaml</code>
- <strong>MERGED</strong>: File <code>intent/intent.yaml</code>
- <strong>GENERATED</strong>: Files in <code>output/</code></p>
<h2 id="intent-schema">Intent Schema</h2>
<h3 id="schema-version-1">Schema Version 1</h3>
<div class="codehilite"><pre><span></span><code><span class="nt">schema_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># Required</span>
<span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">powercli | vrealize | custom</span><span class="w">  </span><span class="c1"># Required</span>
<span class="nt">workflow_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">  </span><span class="c1"># Required</span>

<span class="c1"># Input parameters</span>
<span class="nt">inputs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">  </span><span class="c1"># Required</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string | int | bool | object</span><span class="w">  </span><span class="c1"># Required</span>
<span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bool</span><span class="w">  </span><span class="c1"># Required</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">any</span><span class="w">  </span><span class="c1"># Optional</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">  </span><span class="c1"># Optional</span>
<span class="w">    </span><span class="nt">allowed_values</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">list</span><span class="w">  </span><span class="c1"># Optional for enums</span>

<span class="c1"># Compute resources</span>
<span class="nt">compute</span><span class="p">:</span>
<span class="w">  </span><span class="nt">cpu_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span>
<span class="w">  </span><span class="nt">memory_gb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span>
<span class="w">  </span><span class="nt">cpu_cores_per_socket</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span><span class="w">  </span><span class="c1"># Optional</span>
<span class="w">  </span><span class="nt">cpu_hot_add</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bool</span><span class="w">  </span><span class="c1"># Optional</span>
<span class="w">  </span><span class="nt">memory_hot_add</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bool</span><span class="w">  </span><span class="c1"># Optional</span>

<span class="c1"># Networking configuration</span>
<span class="nt">networking</span><span class="p">:</span>
<span class="w">  </span><span class="nt">interfaces</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">network</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">  </span><span class="c1"># vmxnet3, e1000, etc.</span>

<span class="c1"># Storage configuration</span>
<span class="nt">storage</span><span class="p">:</span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">size_gb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span>
<span class="w">      </span><span class="nt">storage_class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">thin_provisioned</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bool</span><span class="w">  </span><span class="c1"># Optional</span>

<span class="c1"># Environment branching</span>
<span class="nt">environment_branching</span><span class="p">:</span>
<span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bool</span>
<span class="w">  </span><span class="nt">conditions</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span><span class="w">  </span><span class="c1"># Condition expression</span>
<span class="w">      </span><span class="nt">then</span><span class="p">:</span><span class="w">  </span><span class="c1"># Overrides when true</span>
<span class="w">        </span><span class="nt">compute</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">...</span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="nt">networking</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">...</span><span class="p p-Indicator">}</span>
<span class="w">        </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nv">...</span><span class="p p-Indicator">}</span>

<span class="c1"># Governance and compliance</span>
<span class="nt">governance</span><span class="p">:</span>
<span class="w">  </span><span class="nt">approval_required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bool</span>
<span class="w">  </span><span class="nt">approvers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">list[string]</span><span class="w">  </span><span class="c1"># Optional</span>
<span class="w">  </span><span class="nt">approval_timeout_hours</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span><span class="w">  </span><span class="c1"># Optional</span>
<span class="w">  </span><span class="nt">quotas</span><span class="p">:</span>
<span class="w">    </span><span class="nt">max_cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span>
<span class="w">    </span><span class="nt">max_memory_gb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span>
<span class="w">    </span><span class="nt">max_storage_gb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">list[string]</span>
<span class="w">    </span><span class="nt">recommended</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">list[string]</span>

<span class="c1"># Metadata and tagging</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>

<span class="c1"># AI assumptions (from extraction)</span>
<span class="nt">assumptions</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">confidence</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">high | medium | low</span>
</code></pre></div>

<h3 id="schema-validation">Schema Validation</h3>
<p>Intent YAML is validated against JSON Schema:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Simplified validation logic</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_intent_schema</span><span class="p">(</span><span class="n">intent</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Required top-level fields</span>
    <span class="k">if</span> <span class="s1">&#39;schema_version&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">intent</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing &#39;schema_version&#39;&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">intent</span><span class="p">[</span><span class="s1">&#39;schema_version&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported schema_version: </span><span class="si">{</span><span class="n">intent</span><span class="p">[</span><span class="s1">&#39;schema_version&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">intent</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing &#39;type&#39;&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">intent</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;powercli&#39;</span><span class="p">,</span> <span class="s1">&#39;vrealize&#39;</span><span class="p">,</span> <span class="s1">&#39;custom&#39;</span><span class="p">]:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid type: </span><span class="si">{</span><span class="n">intent</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;workflow_name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">intent</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing &#39;workflow_name&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Validate inputs</span>
    <span class="k">if</span> <span class="s1">&#39;inputs&#39;</span> <span class="ow">in</span> <span class="n">intent</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">input_def</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">intent</span><span class="p">[</span><span class="s1">&#39;inputs&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_def</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: missing &#39;name&#39;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_def</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: missing &#39;type&#39;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;required&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_def</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: missing &#39;required&#39;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">errors</span>
</code></pre></div>

<h2 id="llm-integration">LLM Integration</h2>
<h3 id="when-is-llm-required">When is LLM Required?</h3>
<p><strong>Critical Design Decision</strong>: ops-translate separates "understanding" from "translation".</p>
<p><strong>LLM Required</strong> (One Component Only):
- <strong>Intent Extraction</strong> (<code>ops_translate/intent/extract.py</code>)
  - Converts imperative PowerCLI/vRealize code → declarative intent YAML
  - Requires semantic understanding of code logic
  - Alternatives: Manual intent creation, mock provider for testing</p>
<p><strong>LLM NOT Required</strong> (All Other Components):
- <strong>Import</strong> - Simple file copying
- <strong>Summarize</strong> - Regex-based pattern matching
- <strong>Merge</strong> - Deterministic YAML reconciliation
- <strong>Validate</strong> - JSON schema validation
- <strong>Generate</strong> - Jinja2 template rendering
- <strong>Dry-run</strong> - Static analysis</p>
<p><strong>Why This Separation?</strong></p>
<ol>
<li><strong>Reliability</strong>: Templates produce consistent, validated output</li>
<li><strong>Performance</strong>: No API latency for generation</li>
<li><strong>Cost</strong>: One-time extraction cost, infinite free generation</li>
<li><strong>Offline</strong>: After extraction, everything works offline</li>
<li><strong>Trust</strong>: Deterministic generation is easier to audit</li>
</ol>
<p><strong>Data Flow:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">PowerCLI</span><span class="w"> </span><span class="n">Script</span><span class="w">          </span><span class="err">┌─────────────┐</span><span class="w">         </span><span class="n">Intent</span><span class="w"> </span><span class="n">YAML</span>
<span class="w">  </span><span class="p">(</span><span class="n">imperative</span><span class="p">)</span><span class="w">  </span><span class="err">────────</span><span class="o">&gt;</span><span class="err">│</span><span class="w"> </span><span class="n">LLM</span><span class="w"> </span><span class="n">Extract</span><span class="w"> </span><span class="err">│────────</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">declarative</span><span class="p">)</span>
<span class="w">  </span><span class="k">if</span><span class="o">/</span><span class="k">else</span><span class="w"> </span><span class="n">logic</span><span class="w">           </span><span class="err">│</span><span class="w">   </span><span class="n">NEEDS</span><span class="w"> </span><span class="n">AI</span><span class="w">  </span><span class="err">│</span><span class="w">          </span><span class="n">normalized</span>
<span class="w">  </span><span class="n">variables</span><span class="w">               </span><span class="err">└─────────────┘</span><span class="w">          </span><span class="n">validated</span>
<span class="w">                                                       </span><span class="err">│</span>
<span class="w">                                                       </span><span class="err">│</span>
<span class="w">                                                       </span><span class="err">▼</span>
<span class="w">                          </span><span class="err">┌─────────────┐</span><span class="w">         </span><span class="n">Ansible</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">KubeVirt</span>
<span class="w">                          </span><span class="err">│</span><span class="w">  </span><span class="n">Templates</span><span class="w">  </span><span class="err">│────────</span><span class="o">&gt;</span><span class="w">  </span><span class="p">(</span><span class="n">cloud</span><span class="o">-</span><span class="n">native</span><span class="p">)</span>
<span class="w">                          </span><span class="err">│</span><span class="w">   </span><span class="n">NO</span><span class="w"> </span><span class="n">AI</span><span class="w">     </span><span class="err">│</span><span class="w">          </span><span class="n">deterministic</span>
<span class="w">                          </span><span class="err">└─────────────┘</span><span class="w">          </span><span class="n">schema</span><span class="o">-</span><span class="n">compliant</span>
</code></pre></div>

<p><strong>Template-Based Generation is Better:</strong>
- ✅ 100% consistent output
- ✅ Schema-validated by design
- ✅ Works offline
- ✅ No API costs
- ✅ Fast (no network calls)</p>
<p><strong>LLM-Based Generation (Experimental):</strong>
- ⚠️ Variable quality
- ⚠️ Requires parsing/validation
- ⚠️ API costs per generation
- ⚠️ May not follow schema exactly</p>
<p>This is why the <code>generate</code> command uses templates by default, and why the "LLM fallback to templates" warning is actually a good thing.</p>
<h3 id="provider-abstraction">Provider Abstraction</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Base class</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LLMProvider</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_available</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="c1"># Anthropic implementation</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AnthropicProvider</span><span class="p">(</span><span class="n">LLMProvider</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;claude-sonnet-4-5&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;api_key_env&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">anthropic</span><span class="o">.</span><span class="n">Anthropic</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">max_tokens</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_tokens&#39;</span><span class="p">,</span> <span class="mi">4096</span><span class="p">),</span>
            <span class="n">temperature</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_available</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="c1"># Factory function</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_provider</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LLMProvider</span><span class="p">:</span>
    <span class="n">provider_name</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;llm&#39;</span><span class="p">][</span><span class="s1">&#39;provider&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">provider_name</span> <span class="o">==</span> <span class="s1">&#39;anthropic&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">AnthropicProvider</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;llm&#39;</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">provider_name</span> <span class="o">==</span> <span class="s1">&#39;openai&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">OpenAIProvider</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;llm&#39;</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">provider_name</span> <span class="o">==</span> <span class="s1">&#39;mock&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MockProvider</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;llm&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported provider: </span><span class="si">{</span><span class="n">provider_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="prompt-engineering">Prompt Engineering</h3>
<p>Prompts are structured as Markdown files in <code>prompts/</code>:</p>
<p><strong>Key Sections</strong>:
1. <strong>Role</strong>: Set LLM context
2. <strong>Task</strong>: Define extraction/generation goal
3. <strong>Input</strong>: Source automation content
4. <strong>Schema</strong>: Expected output format
5. <strong>Guidelines</strong>: Specific instructions
6. <strong>Examples</strong>: Few-shot learning</p>
<p><strong>Example Prompt Template</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="gh"># Role</span>
You are an expert in VMware PowerCLI and OpenShift migration.

<span class="gh"># Task</span>
Extract the operational intent from this PowerCLI script and produce structured YAML.

<span class="gh"># Input</span>
```powershell
{script_content}
</code></pre></div>

<h1 id="output-schema">Output Schema</h1>
<div class="codehilite"><pre><span></span><code><span class="nt">schema_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">powercli</span>
<span class="nt">workflow_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;name&gt;</span>
<span class="nt">inputs</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;param_name&gt;</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;string|int|bool&gt;</span>
<span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;true|false&gt;</span>
<span class="nt">compute</span><span class="p">:</span>
<span class="w">  </span><span class="nt">cpu_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;number&gt;</span>
<span class="w">  </span><span class="nt">memory_gb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;number&gt;</span>
</code></pre></div>

<h1 id="guidelines">Guidelines</h1>
<ol>
<li>Extract ALL input parameters with correct types</li>
<li>Detect environment branching logic (dev/prod/staging)</li>
<li>Identify compute resource values</li>
<li>Note any approval or governance requirements</li>
<li>Log assumptions in the assumptions section</li>
</ol>
<h1 id="output">Output</h1>
<p>Provide the YAML inside a markdown code block.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">### Response Parsing</span>

<span class="err">```</span><span class="n">python</span>
<span class="n">def</span><span class="w"> </span><span class="n">extract_yaml_from_markdown</span><span class="p">(</span><span class="n">response</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract YAML from markdown code blocks.&quot;&quot;&quot;</span>
<span class="w">    </span><span class="c1"># Look for ```yaml or ```</span>
<span class="w">    </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sa">r</span><span class="s1">&#39;```(?:yaml)?\n(.*?)\n```&#39;</span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="k">match</span><span class="p">:</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># Assume entire response is YAML</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">response</span>

<span class="n">def</span><span class="w"> </span><span class="n">parse_intent_from_llm</span><span class="p">(</span><span class="n">response</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse LLM response into intent dictionary.&quot;&quot;&quot;</span>
<span class="w">    </span><span class="n">yaml_content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extract_yaml_from_markdown</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

<span class="w">    </span><span class="n">try</span><span class="p">:</span>
<span class="w">        </span><span class="n">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">yaml_content</span><span class="p">)</span>
<span class="w">    </span><span class="n">except</span><span class="w"> </span><span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">e</span><span class="p">:</span>
<span class="w">        </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;LLM produced invalid YAML: {e}&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># Validate schema</span>
<span class="w">    </span><span class="n">errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validate_intent_schema</span><span class="p">(</span><span class="n">intent</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">errors</span><span class="p">:</span>
<span class="w">        </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Intent validation failed: {errors}&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">intent</span>
</code></pre></div>

<h2 id="generation-pipeline">Generation Pipeline</h2>
<h3 id="two-phase-generation">Two-Phase Generation</h3>
<p><strong>Phase 1: Intent → Intermediate Representation</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">intent_to_ir</span><span class="p">(</span><span class="n">intent</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert intent to intermediate representation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;vm_definition&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">extract_vm_name</span><span class="p">(</span><span class="n">intent</span><span class="p">),</span>
            <span class="s1">&#39;cpu&#39;</span><span class="p">:</span> <span class="n">intent</span><span class="p">[</span><span class="s1">&#39;compute&#39;</span><span class="p">][</span><span class="s1">&#39;cpu_count&#39;</span><span class="p">],</span>
            <span class="s1">&#39;memory&#39;</span><span class="p">:</span> <span class="n">intent</span><span class="p">[</span><span class="s1">&#39;compute&#39;</span><span class="p">][</span><span class="s1">&#39;memory_gb&#39;</span><span class="p">],</span>
            <span class="s1">&#39;networks&#39;</span><span class="p">:</span> <span class="n">extract_networks</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="n">profile</span><span class="p">),</span>
            <span class="s1">&#39;storage&#39;</span><span class="p">:</span> <span class="n">extract_storage</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="n">profile</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s1">&#39;automation&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ansible&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tasks&#39;</span><span class="p">:</span> <span class="n">extract_tasks</span><span class="p">(</span><span class="n">intent</span><span class="p">),</span>
            <span class="s1">&#39;vars&#39;</span><span class="p">:</span> <span class="n">extract_variables</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="n">profile</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s1">&#39;governance&#39;</span><span class="p">:</span> <span class="n">extract_governance</span><span class="p">(</span><span class="n">intent</span><span class="p">),</span>
    <span class="p">}</span>
</code></pre></div>

<p><strong>Phase 2: IR → Target Artifacts</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ir_to_kubevirt</span><span class="p">(</span><span class="n">ir</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render KubeVirt YAML from IR.&quot;&quot;&quot;</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">load_jinja2_template</span><span class="p">(</span><span class="s1">&#39;kubevirt_vm.yaml.j2&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">vm</span><span class="o">=</span><span class="n">ir</span><span class="p">[</span><span class="s1">&#39;vm_definition&#39;</span><span class="p">])</span>

<span class="k">def</span><span class="w"> </span><span class="nf">ir_to_ansible</span><span class="p">(</span><span class="n">ir</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render Ansible playbook from IR.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;site.yml&#39;</span><span class="p">:</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;site.yml.j2&#39;</span><span class="p">,</span> <span class="n">ir</span><span class="p">),</span>
        <span class="s1">&#39;tasks/main.yml&#39;</span><span class="p">:</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;tasks.yml.j2&#39;</span><span class="p">,</span> <span class="n">ir</span><span class="p">),</span>
        <span class="s1">&#39;defaults/main.yml&#39;</span><span class="p">:</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;defaults.yml.j2&#39;</span><span class="p">,</span> <span class="n">ir</span><span class="p">),</span>
    <span class="p">}</span>
</code></pre></div>

<h3 id="profile-resolution">Profile Resolution</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resolve_profile</span><span class="p">(</span><span class="n">intent</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply profile defaults to intent.&quot;&quot;&quot;</span>
    <span class="n">resolved</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Apply namespace</span>
    <span class="k">if</span> <span class="s1">&#39;networking&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">resolved</span><span class="p">:</span>
        <span class="n">resolved</span><span class="p">[</span><span class="s1">&#39;networking&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">resolved</span><span class="p">[</span><span class="s1">&#39;networking&#39;</span><span class="p">][</span><span class="s1">&#39;namespace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;default_namespace&#39;</span><span class="p">]</span>

    <span class="c1"># Apply network default if not specified</span>
    <span class="k">if</span> <span class="s1">&#39;network&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">resolved</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;networking&#39;</span><span class="p">,</span> <span class="p">{}):</span>
        <span class="n">resolved</span><span class="p">[</span><span class="s1">&#39;networking&#39;</span><span class="p">][</span><span class="s1">&#39;network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;default_network&#39;</span><span class="p">]</span>

    <span class="c1"># Apply storage class</span>
    <span class="k">for</span> <span class="n">volume</span> <span class="ow">in</span> <span class="n">resolved</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;storage&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;volumes&#39;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="k">if</span> <span class="s1">&#39;storage_class&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">volume</span><span class="p">:</span>
            <span class="n">volume</span><span class="p">[</span><span class="s1">&#39;storage_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="s1">&#39;default_storage_class&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">resolved</span>
</code></pre></div>

<h2 id="gap-analysis-architecture">Gap Analysis Architecture</h2>
<h3 id="overview">Overview</h3>
<p>The gap analysis system automatically assesses the translatability of vRealize workflows to OpenShift, providing migration guidance for components that cannot be fully automatically translated.</p>
<p><strong>Architecture Goals:</strong>
- Detect NSX operations, custom plugins, and external dependencies
- Classify components by translatability level
- Generate actionable migration recommendations
- Integrate seamlessly into existing workflow (runs during <code>intent extract</code>)
- Support plugin-based extensibility for new component types</p>
<h3 id="architecture-diagram">Architecture Diagram</h3>
<div class="codehilite"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">              </span><span class="n">ops</span><span class="o">-</span><span class="n">translate</span><span class="w"> </span><span class="n">intent</span><span class="w"> </span><span class="n">extract</span><span class="w">                   </span><span class="err">│</span>
<span class="err">└─────────────────┬───────────────────────────────────────────┘</span>
<span class="w">                  </span><span class="err">│</span>
<span class="w">                  </span><span class="err">│</span><span class="w"> </span><span class="p">(</span><span class="k">for</span><span class="w"> </span><span class="n">vRealize</span><span class="w"> </span><span class="n">workflows</span><span class="p">)</span>
<span class="w">                  </span><span class="err">▼</span>
<span class="err">┌─────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                 </span><span class="n">Workflow</span><span class="w"> </span><span class="n">Analyzer</span><span class="w">                           </span><span class="err">│</span>
<span class="err">│</span><span class="w">              </span><span class="p">(</span><span class="n">analyze</span><span class="o">/</span><span class="n">vrealize</span><span class="o">.</span><span class="n">py</span><span class="p">)</span><span class="w">                          </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Parse</span><span class="w"> </span><span class="n">XML</span><span class="w"> </span><span class="n">workflow</span><span class="w"> </span><span class="n">structure</span><span class="w">                             </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Detect</span><span class="w"> </span><span class="n">NSX</span><span class="w"> </span><span class="n">API</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="p">(</span><span class="n">createSegment</span><span class="p">,</span><span class="w"> </span><span class="n">createFirewall</span><span class="o">...</span><span class="p">)</span><span class="w">  </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Detect</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">vRO</span><span class="w"> </span><span class="n">plugins</span><span class="w"> </span><span class="p">(</span><span class="n">ServiceNow</span><span class="p">,</span><span class="w"> </span><span class="n">Infoblox</span><span class="o">...</span><span class="p">)</span><span class="w">      </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Detect</span><span class="w"> </span><span class="n">REST</span><span class="w"> </span><span class="n">API</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="n">systems</span><span class="w">                </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Calculate</span><span class="w"> </span><span class="n">confidence</span><span class="w"> </span><span class="n">scores</span><span class="w"> </span><span class="p">(</span><span class="mf">0.0</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="w">                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Capture</span><span class="w"> </span><span class="n">evidence</span><span class="w"> </span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="n">numbers</span><span class="p">,</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">snippets</span><span class="p">)</span><span class="w">           </span><span class="err">│</span>
<span class="err">└─────────────────┬───────────────────────────────────────────┘</span>
<span class="w">                  </span><span class="err">│</span>
<span class="w">                  </span><span class="err">│</span><span class="w"> </span><span class="n">analysis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="err">│</span><span class="w">   </span><span class="s2">&quot;nsx_operations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="o">...</span><span class="p">},</span>
<span class="w">                  </span><span class="err">│</span><span class="w">   </span><span class="s2">&quot;custom_plugins&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="o">...</span><span class="p">],</span>
<span class="w">                  </span><span class="err">│</span><span class="w">   </span><span class="s2">&quot;rest_api_calls&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="o">...</span><span class="p">],</span>
<span class="w">                  </span><span class="err">│</span><span class="w">   </span><span class="s2">&quot;signals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;nsx_keywords&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="o">...</span><span class="p">}</span>
<span class="w">                  </span><span class="err">│</span><span class="w"> </span><span class="p">}</span>
<span class="w">                  </span><span class="err">▼</span>
<span class="err">┌─────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">               </span><span class="n">Classification</span><span class="w"> </span><span class="n">System</span><span class="w">                         </span><span class="err">│</span>
<span class="err">│</span><span class="w">               </span><span class="p">(</span><span class="n">intent</span><span class="o">/</span><span class="n">classify</span><span class="o">.</span><span class="n">py</span><span class="p">)</span><span class="w">                          </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Discover</span><span class="w"> </span><span class="n">classifier</span><span class="w"> </span><span class="n">plugins</span><span class="w"> </span><span class="p">(</span><span class="n">intent</span><span class="o">/</span><span class="n">classifiers</span><span class="o">/</span><span class="p">)</span><span class="w">        </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Run</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">classifier</span><span class="p">:</span><span class="w"> </span><span class="n">can_classify</span><span class="p">()</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">classify</span><span class="p">()</span><span class="w">         </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Assign</span><span class="w"> </span><span class="n">translatability</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="p">(</span><span class="n">SUPPORTED</span><span class="o">/</span><span class="n">PARTIAL</span><span class="o">/</span><span class="n">etc</span><span class="p">)</span><span class="w">    </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Assign</span><span class="w"> </span><span class="n">migration</span><span class="w"> </span><span class="n">paths</span><span class="w"> </span><span class="p">(</span><span class="n">PATH_A</span><span class="o">/</span><span class="n">PATH_B</span><span class="o">/</span><span class="n">PATH_C</span><span class="p">)</span><span class="w">            </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">recommendations</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">component</span><span class="w">                   </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Sort</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">severity</span><span class="w"> </span><span class="p">(</span><span class="n">worst</span><span class="w"> </span><span class="n">issues</span><span class="w"> </span><span class="n">first</span><span class="p">)</span><span class="w">                    </span><span class="err">│</span>
<span class="err">└─────────────────┬───────────────────────────────────────────┘</span>
<span class="w">                  </span><span class="err">│</span>
<span class="w">                  </span><span class="err">│</span><span class="w"> </span><span class="n">components</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">                  </span><span class="err">│</span><span class="w">   </span><span class="n">ClassifiedComponent</span><span class="p">(</span>
<span class="w">                  </span><span class="err">│</span><span class="w">     </span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;NSX Segment&quot;</span><span class="p">,</span>
<span class="w">                  </span><span class="err">│</span><span class="w">     </span><span class="n">level</span><span class="o">=</span><span class="n">PARTIAL</span><span class="p">,</span>
<span class="w">                  </span><span class="err">│</span><span class="w">     </span><span class="n">migration_path</span><span class="o">=</span><span class="n">PATH_A</span><span class="p">,</span>
<span class="w">                  </span><span class="err">│</span><span class="w">     </span><span class="n">recommendations</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="w">                  </span><span class="err">│</span><span class="w">   </span><span class="p">),</span><span class="w"> </span><span class="o">...</span>
<span class="w">                  </span><span class="err">│</span><span class="w"> </span><span class="p">]</span>
<span class="w">                  </span><span class="err">▼</span>
<span class="err">┌─────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">                 </span><span class="n">Gap</span><span class="w"> </span><span class="n">Report</span><span class="w"> </span><span class="n">Generator</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">                  </span><span class="p">(</span><span class="n">intent</span><span class="o">/</span><span class="n">gaps</span><span class="o">.</span><span class="n">py</span><span class="p">)</span><span class="w">                           </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Generate</span><span class="w"> </span><span class="n">gaps</span><span class="o">.</span><span class="n">md</span><span class="w"> </span><span class="p">(</span><span class="n">Markdown</span><span class="w"> </span><span class="n">report</span><span class="p">)</span><span class="w">                       </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Generate</span><span class="w"> </span><span class="n">gaps</span><span class="o">.</span><span class="n">json</span><span class="w"> </span><span class="p">(</span><span class="n">machine</span><span class="o">-</span><span class="n">readable</span><span class="p">)</span><span class="w">                    </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Display</span><span class="w"> </span><span class="n">console</span><span class="w"> </span><span class="n">warnings</span><span class="w">                                 </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">migration</span><span class="w"> </span><span class="n">guidance</span><span class="w"> </span><span class="n">summaries</span><span class="w">                      </span><span class="err">│</span>
<span class="err">└─────────────────┬───────────────────────────────────────────┘</span>
<span class="w">                  </span><span class="err">│</span>
<span class="w">                  </span><span class="err">│</span><span class="w"> </span><span class="n">Output</span><span class="p">:</span>
<span class="w">                  </span><span class="err">│</span><span class="w">   </span><span class="n">intent</span><span class="o">/</span><span class="n">gaps</span><span class="o">.</span><span class="n">md</span>
<span class="w">                  </span><span class="err">│</span><span class="w">   </span><span class="n">intent</span><span class="o">/</span><span class="n">gaps</span><span class="o">.</span><span class="n">json</span>
<span class="w">                  </span><span class="err">▼</span>
<span class="err">┌─────────────────────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">           </span><span class="n">Ansible</span><span class="w"> </span><span class="n">Gap</span><span class="w"> </span><span class="n">Scaffolding</span><span class="w">                           </span><span class="err">│</span>
<span class="err">│</span><span class="w">           </span><span class="p">(</span><span class="n">generate</span><span class="o">/</span><span class="n">ansible</span><span class="o">.</span><span class="n">py</span><span class="p">)</span><span class="w">                             </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Load</span><span class="w"> </span><span class="n">gaps</span><span class="o">.</span><span class="n">json</span><span class="w">                                           </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Inject</span><span class="w"> </span><span class="n">TODO</span><span class="w"> </span><span class="n">tasks</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">PARTIAL</span><span class="o">/</span><span class="n">BLOCKED</span><span class="w"> </span><span class="n">components</span><span class="w">        </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Generate</span><span class="w"> </span><span class="n">role</span><span class="w"> </span><span class="n">stubs</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MANUAL</span><span class="w"> </span><span class="n">components</span><span class="w">                </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="err">•</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">gap</span><span class="w"> </span><span class="n">summary</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">playbooks</span><span class="w">                      </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="component-details">Component Details</h3>
<h4 id="1-workflow-analyzer-analyzevrealizepy">1. Workflow Analyzer (<code>analyze/vrealize.py</code>)</h4>
<p><strong>Purpose</strong>: Parse vRealize workflow XML and detect external dependencies.</p>
<p><strong>Detection Patterns:</strong></p>
<p>NSX Operations:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># API call detection (high confidence)</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;nsxClient\.(create|update|delete|get)(\w+)\(&#39;</span>
<span class="c1"># → createSegment, createFirewallRule, etc.</span>

<span class="c1"># Object type detection (medium confidence)</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;new\s+(Segment|FirewallRule|LoadBalancer)\(&#39;</span>
<span class="c1"># → Type instantiation</span>

<span class="c1"># Keyword detection (low confidence)</span>
<span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nsx&#39;</span><span class="p">,</span> <span class="s1">&#39;segment&#39;</span><span class="p">,</span> <span class="s1">&#39;tier&#39;</span><span class="p">,</span> <span class="s1">&#39;firewall&#39;</span><span class="p">]</span>
<span class="c1"># → Contextual mentions</span>
</code></pre></div>

<p>Custom Plugins:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Module path detection</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;System\.getModule\(&quot;([^&quot;]+)&quot;\)&#39;</span>
<span class="c1"># → &quot;com.vmware.library.servicenow&quot;</span>

<span class="c1"># Type annotations</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;type=&quot;([^:]+):([^&quot;]+)&quot;&#39;</span>
<span class="c1"># → ServiceNow:Connection, Infoblox:Server</span>
</code></pre></div>

<p>REST Calls:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># restClient methods</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;restClient\.(get|post|put|delete|patch)\(&#39;</span>

<span class="c1"># fetch() calls</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;fetch\([&quot;</span><span class="se">\&#39;</span><span class="s1">]([^&quot;</span><span class="se">\&#39;</span><span class="s1">]+)&#39;</span>

<span class="c1"># XMLHttpRequest</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;new XMLHttpRequest\(\)&#39;</span>
</code></pre></div>

<p><strong>Confidence Scoring:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_detection_confidence</span><span class="p">(</span><span class="n">detection_type</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">keyword</span><span class="p">):</span>
    <span class="n">base_scores</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;api_call&quot;</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span>       <span class="c1"># nsxClient.createSegment()</span>
        <span class="s2">&quot;object_type&quot;</span><span class="p">:</span> <span class="mf">0.60</span><span class="p">,</span>    <span class="c1"># new Segment()</span>
        <span class="s2">&quot;keyword&quot;</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span>        <span class="c1"># &quot;nsx tier1&quot;</span>
    <span class="p">}</span>

    <span class="n">confidence</span> <span class="o">=</span> <span class="n">base_scores</span><span class="p">[</span><span class="n">detection_type</span><span class="p">]</span>

    <span class="c1"># Boost for supportive context</span>
    <span class="k">if</span> <span class="s2">&quot;nsx&quot;</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">confidence</span> <span class="o">+=</span> <span class="mf">0.05</span>
    <span class="k">if</span> <span class="s2">&quot;.createSegment&quot;</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span> <span class="n">confidence</span> <span class="o">+=</span> <span class="mf">0.05</span>
    <span class="k">if</span> <span class="s2">&quot;POST&quot;</span> <span class="ow">in</span> <span class="n">context</span> <span class="ow">or</span> <span class="s2">&quot;/api&quot;</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span> <span class="n">confidence</span> <span class="o">+=</span> <span class="mf">0.05</span>

    <span class="c1"># Cap at 0.95 (never 100% certain)</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">confidence</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">)</span>
</code></pre></div>

<h4 id="2-classifier-plugin-system-intentclassifiers">2. Classifier Plugin System (<code>intent/classifiers/</code>)</h4>
<p><strong>Base Interface</strong> (<code>classifiers/base.py</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseClassifier</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for component classifiers.&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Classifier identifier</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Lower = runs first</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">can_classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if this classifier can handle the analysis.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ClassifiedComponent</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Classify components from analysis data.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div>

<p><strong>NSX Classifier</strong> (<code>classifiers/nsx.py</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NSXClassifier</span><span class="p">(</span><span class="n">BaseClassifier</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;nsx&quot;</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">can_classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nsx_operations&quot;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ClassifiedComponent</span><span class="p">]:</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Classify NSX segments</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;nsx_operations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;segments&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ClassifiedComponent</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;NSX Segment&quot;</span><span class="p">,</span>
                <span class="n">component_type</span><span class="o">=</span><span class="s2">&quot;nsx_segment&quot;</span><span class="p">,</span>
                <span class="n">level</span><span class="o">=</span><span class="n">TranslatabilityLevel</span><span class="o">.</span><span class="n">PARTIAL</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Can be replaced with NetworkAttachmentDefinition&quot;</span><span class="p">,</span>
                <span class="n">openshift_equivalent</span><span class="o">=</span><span class="s2">&quot;NetworkAttachmentDefinition (Multus CNI)&quot;</span><span class="p">,</span>
                <span class="n">migration_path</span><span class="o">=</span><span class="n">MigrationPath</span><span class="o">.</span><span class="n">PATH_A</span><span class="p">,</span>
                <span class="n">evidence</span><span class="o">=</span><span class="n">segment</span><span class="p">[</span><span class="s2">&quot;evidence&quot;</span><span class="p">],</span>
                <span class="n">recommendations</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;Create NetworkAttachmentDefinition manifest&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Configure Multus CNI on target cluster&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Test network connectivity&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">))</span>

        <span class="c1"># Classify NSX firewall rules → NetworkPolicy (PARTIAL)</span>
        <span class="c1"># Classify NSX security groups → NetworkPolicy (BLOCKED)</span>
        <span class="c1"># Classify NSX load balancers → Service/Route (PARTIAL)</span>

        <span class="k">return</span> <span class="n">components</span>
</code></pre></div>

<p><strong>Classifier Discovery:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">discover_classifiers</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">BaseClassifier</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Auto-discover and instantiate all classifiers.&quot;&quot;&quot;</span>
    <span class="n">classifiers_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;classifiers&quot;</span>

    <span class="n">classifiers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">py_file</span> <span class="ow">in</span> <span class="n">classifiers_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.py&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">py_file</span><span class="o">.</span><span class="n">stem</span> <span class="o">==</span> <span class="s2">&quot;base&quot;</span> <span class="ow">or</span> <span class="n">py_file</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="c1"># Dynamic import and instantiation</span>
        <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ops_translate.intent.classifiers.</span><span class="si">{</span><span class="n">py_file</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">BaseClassifier</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj</span> <span class="o">!=</span> <span class="n">BaseClassifier</span><span class="p">:</span>
                <span class="n">classifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">())</span>

    <span class="c1"># Sort by priority (lower number = higher priority)</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">classifiers</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">priority</span><span class="p">)</span>
</code></pre></div>

<h4 id="3-classification-levels">3. Classification Levels</h4>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TranslatabilityLevel</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Component translatability classification.&quot;&quot;&quot;</span>

    <span class="n">SUPPORTED</span> <span class="o">=</span> <span class="s2">&quot;SUPPORTED&quot;</span>  <span class="c1"># Fully automatic</span>
    <span class="n">PARTIAL</span> <span class="o">=</span> <span class="s2">&quot;PARTIAL&quot;</span>      <span class="c1"># Auto with manual config</span>
    <span class="n">BLOCKED</span> <span class="o">=</span> <span class="s2">&quot;BLOCKED&quot;</span>      <span class="c1"># Cannot auto-translate</span>
    <span class="n">MANUAL</span> <span class="o">=</span> <span class="s2">&quot;MANUAL&quot;</span>        <span class="c1"># Custom logic required</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">emoji</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;SUPPORTED&quot;</span><span class="p">:</span> <span class="s2">&quot;✅&quot;</span><span class="p">,</span> <span class="s2">&quot;PARTIAL&quot;</span><span class="p">:</span> <span class="s2">&quot;⚠️&quot;</span><span class="p">,</span>
                <span class="s2">&quot;BLOCKED&quot;</span><span class="p">:</span> <span class="s2">&quot;🚫&quot;</span><span class="p">,</span> <span class="s2">&quot;MANUAL&quot;</span><span class="p">:</span> <span class="s2">&quot;👷&quot;</span><span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">severity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;For sorting (higher severity = more problematic).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;SUPPORTED&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;PARTIAL&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;BLOCKED&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;MANUAL&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
</code></pre></div>

<h4 id="4-migration-paths">4. Migration Paths</h4>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MigrationPath</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Recommended migration approach.&quot;&quot;&quot;</span>

    <span class="n">PATH_A</span> <span class="o">=</span> <span class="s2">&quot;PATH_A&quot;</span>  <span class="c1"># OpenShift-native replacement</span>
    <span class="n">PATH_B</span> <span class="o">=</span> <span class="s2">&quot;PATH_B&quot;</span>  <span class="c1"># Hybrid (keep existing temporarily)</span>
    <span class="n">PATH_C</span> <span class="o">=</span> <span class="s2">&quot;PATH_C&quot;</span>  <span class="c1"># Custom specialist implementation</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;PATH_A&quot;</span><span class="p">:</span> <span class="s2">&quot;OpenShift-native replacement&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PATH_B&quot;</span><span class="p">:</span> <span class="s2">&quot;Hybrid approach (keep existing temporarily)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PATH_C&quot;</span><span class="p">:</span> <span class="s2">&quot;Custom specialist implementation&quot;</span><span class="p">,</span>
        <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
</code></pre></div>

<p><strong>Path Selection Logic:</strong>
- <strong>PATH_A</strong>: Direct OpenShift equivalent exists (e.g., NetworkPolicy for NSX firewall)
- <strong>PATH_B</strong>: Keep VMware component temporarily, plan replacement (e.g., external load balancer)
- <strong>PATH_C</strong>: No direct equivalent, requires custom development (e.g., complex ServiceNow integration)</p>
<h4 id="5-gap-report-generation">5. Gap Report Generation</h4>
<p><strong>Markdown Report Structure</strong> (<code>gaps.md</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="gh"># Gap Analysis Report: {workflow_name}</span>

<span class="gu">## Executive Summary</span>
<span class="k">-</span><span class="w"> </span>Overall Assessment: REQUIRES_MANUAL_WORK
<span class="k">-</span><span class="w"> </span>Total Components: 8
<span class="k">-</span><span class="w"> </span>✅ SUPPORTED: 3
<span class="k">-</span><span class="w"> </span>⚠️ PARTIAL: 3
<span class="k">-</span><span class="w"> </span>🚫 BLOCKED: 2

<span class="gu">## Migration Path Recommendations</span>
<span class="gu">### PATH_A: OpenShift-native replacement (3 components)</span>
<span class="gu">### PATH_B: Hybrid approach (2 components)</span>
<span class="gu">### PATH_C: Custom specialist implementation (3 components)</span>

<span class="gu">## Detailed Component Analysis</span>
[For each component: type, classification, equivalent, recommendations, evidence]

<span class="gu">## Next Steps</span>
<span class="k">1.</span> Review BLOCKED/MANUAL components
<span class="k">2.</span> Choose migration path
<span class="k">3.</span> Implement manual tasks
...
</code></pre></div>

<p><strong>JSON Report Structure</strong> (<code>gaps.json</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;workflow_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;nsx-provisioning&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;summary&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;total_components&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;counts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;SUPPORTED&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;PARTIAL&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;BLOCKED&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;MANUAL&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;overall_assessment&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;REQUIRES_MANUAL_WORK&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;has_blocking_issues&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;requires_manual_work&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;migration_paths&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;PATH_A&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;PATH_B&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;PATH_C&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;NONE&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;components&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NSX Segment&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;component_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;nsx_segment&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PARTIAL&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Can be replaced with NetworkAttachmentDefinition&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;openshift_equivalent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NetworkAttachmentDefinition (Multus CNI)&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;migration_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PATH_A&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;evidence&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;nsxClient.createSegment() at line 23&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;location&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;workflow.xml:23&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;recommendations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;Create NetworkAttachmentDefinition manifest&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;Configure Multus CNI on target cluster&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;Test network connectivity&quot;</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;migration_guidance&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;overall_assessment&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;REQUIRES_MANUAL_WORK&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;has_blocking_issues&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;requires_manual_work&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;recommended_paths&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;PATH_A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PATH_B&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PATH_C&quot;</span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="6-ansible-gap-scaffolding">6. Ansible Gap Scaffolding</h4>
<p><strong>TODO Task Injection:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_inject_gap_todos</span><span class="p">(</span><span class="n">tasks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">gaps_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inject TODO tasks for gap analysis findings.&quot;&quot;&quot;</span>
    <span class="n">todo_tasks</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">gaps_data</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">component</span><span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;PARTIAL&quot;</span><span class="p">,</span> <span class="s2">&quot;BLOCKED&quot;</span><span class="p">,</span> <span class="s2">&quot;MANUAL&quot;</span><span class="p">):</span>
            <span class="n">todo_task</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;_comment&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;# TODO: </span><span class="si">{</span><span class="n">component</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">component</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;TODO: Review </span><span class="si">{</span><span class="n">component</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> migration (</span><span class="si">{</span><span class="n">component</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CLASSIFICATION: </span><span class="si">{</span><span class="n">component</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s2">COMPONENT: </span><span class="si">{</span><span class="n">component</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s2">OPENSHIFT EQUIVALENT: </span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;openshift_equivalent&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span>
<span class="s2">MIGRATION PATH: </span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;migration_path&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span>

<span class="s2">RECOMMENDATIONS:</span>
<span class="si">{</span><span class="nb">chr</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;- &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">component</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;recommendations&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[]))</span><span class="si">}</span>
<span class="s2">&quot;&quot;&quot;</span>
                <span class="p">},</span>
                <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;manual_review_required&quot;</span> <span class="k">if</span> <span class="n">component</span><span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PARTIAL&quot;</span>
                        <span class="k">else</span> <span class="s2">&quot;manual_implementation_required&quot;</span><span class="p">]</span>
            <span class="p">}</span>
            <span class="n">todo_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">todo_task</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">todo_tasks</span>
</code></pre></div>

<p><strong>Role Stub Generation:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_create_manual_role_stub</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">component</span><span class="p">,</span> <span class="n">workspace</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create Ansible role stub for MANUAL components.&quot;&quot;&quot;</span>
    <span class="n">role_name</span> <span class="o">=</span> <span class="n">component</span><span class="p">[</span><span class="s2">&quot;component_type&quot;</span><span class="p">]</span>
    <span class="n">role_dir</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="s2">&quot;ansible/roles&quot;</span> <span class="o">/</span> <span class="n">role_name</span>

    <span class="c1"># Create role structure</span>
    <span class="p">(</span><span class="n">role_dir</span> <span class="o">/</span> <span class="s2">&quot;tasks&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">(</span><span class="n">role_dir</span> <span class="o">/</span> <span class="s2">&quot;defaults&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Generate README with migration guidance</span>
    <span class="n">readme_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2"># </span><span class="si">{</span><span class="n">component</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Migration Role</span>

<span class="s2">**Classification**: </span><span class="si">{</span><span class="n">component</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s2">**OpenShift Equivalent**: </span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;openshift_equivalent&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span>
<span class="s2">**Migration Path**: </span><span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;migration_path&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span>

<span class="s2">## What Needs Implementation</span>
<span class="si">{</span><span class="nb">chr</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;- &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">component</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;recommendations&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[]))</span><span class="si">}</span>

<span class="s2">## Evidence</span>
<span class="si">{</span><span class="n">component</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;evidence&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;No evidence available&#39;</span><span class="p">)</span><span class="si">}</span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">role_dir</span> <span class="o">/</span> <span class="s2">&quot;README.md&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">readme_content</span><span class="p">)</span>

    <span class="c1"># Generate tasks/main.yml with TODO placeholders</span>
    <span class="c1"># Generate defaults/main.yml with discovered parameters</span>
</code></pre></div>

<h3 id="extension-adding-new-classifiers">Extension: Adding New Classifiers</h3>
<p>To add support for new component types (e.g., vRealize custom actions, Active Directory operations):</p>
<ol>
<li><strong>Create classifier</strong> (<code>intent/classifiers/custom_action.py</code>):</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseClassifier</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomActionClassifier</span><span class="p">(</span><span class="n">BaseClassifier</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;custom_action&quot;</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Run after NSX classifier</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">can_classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_actions&quot;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ClassifiedComponent</span><span class="p">]:</span>
        <span class="c1"># Implement classification logic</span>
        <span class="k">pass</span>
</code></pre></div>

<ol>
<li><strong>Update analyzer</strong> (<code>analyze/vrealize.py</code>):</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">analyze_vrealize_workflow</span><span class="p">(</span><span class="n">xml_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="c1"># ... existing code ...</span>

    <span class="c1"># Add custom action detection</span>
    <span class="n">custom_actions</span> <span class="o">=</span> <span class="n">detect_custom_actions</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="c1"># ... existing fields ...</span>
        <span class="s2">&quot;custom_actions&quot;</span><span class="p">:</span> <span class="n">custom_actions</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div>

<ol>
<li><strong>Classifier auto-discovered</strong> - No registration needed!</li>
</ol>
<p>The plugin system automatically discovers and uses new classifiers based on the <code>BaseClassifier</code> interface.</p>
<h2 id="extension-points">Extension Points</h2>
<h3 id="adding-new-source-types">Adding New Source Types</h3>
<p>To add support for new automation sources (e.g., Terraform, ARM templates):</p>
<ol>
<li><strong>Add summarize module</strong>: <code>ops_translate/summarize/terraform.py</code></li>
<li><strong>Add extraction prompt</strong>: <code>prompts/intent_extract_terraform.md</code></li>
<li><strong>Update import command</strong>: Accept new source type</li>
<li><strong>Add tests</strong>: <code>tests/test_terraform.py</code></li>
</ol>
<h3 id="adding-new-target-platforms">Adding New Target Platforms</h3>
<p>To add support for new targets (e.g., AWS, Azure):</p>
<ol>
<li><strong>Add generator module</strong>: <code>ops_translate/generate/aws.py</code></li>
<li><strong>Add generation prompt</strong>: <code>prompts/generate_aws.md</code></li>
<li><strong>Add templates</strong>: <code>templates/aws/</code></li>
<li><strong>Update generate command</strong>: Accept new target type</li>
</ol>
<h3 id="adding-new-llm-providers">Adding New LLM Providers</h3>
<p>To add a new LLM provider:</p>
<ol>
<li>
<p><strong>Create provider class</strong>: <code>ops_translate/llm/newprovider.py</code>
   ```python
   class NewProvider(LLMProvider):
       def generate(self, prompt: str, **kwargs) -&gt; str:
           # Implementation
           pass</p>
<p>def is_available(self) -&gt; bool:
       # Check API key
       pass
   ```</p>
</li>
<li>
<p><strong>Update factory</strong>: <code>ops_translate/llm/__init__.py</code>
   <code>python
   def get_provider(config: dict) -&gt; LLMProvider:
       provider = config['llm']['provider']
       if provider == 'newprovider':
           return NewProvider(config['llm'])
       # ...</code></p>
</li>
<li>
<p><strong>Add configuration</strong>: Document in <code>ops-translate.yaml</code></p>
</li>
<li>
<p><strong>Add tests</strong>: <code>tests/test_llm.py</code></p>
</li>
</ol>
<h3 id="custom-merge-strategies">Custom Merge Strategies</h3>
<p>To implement custom merge strategies:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ops_translate/intent/merge.py</span>

<span class="k">def</span><span class="w"> </span><span class="nf">register_merge_strategy</span><span class="p">(</span><span class="n">field_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">strategy</span><span class="p">:</span> <span class="n">Callable</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Register custom merge strategy for a field.&quot;&quot;&quot;</span>
    <span class="n">MERGE_STRATEGIES</span><span class="p">[</span><span class="n">field_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">strategy</span>

<span class="c1"># Custom strategy example</span>
<span class="k">def</span><span class="w"> </span><span class="nf">merge_custom_field</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">conflicts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom merge logic.&quot;&quot;&quot;</span>
    <span class="c1"># Your logic here</span>
    <span class="k">return</span> <span class="n">merged_value</span>

<span class="c1"># Usage</span>
<span class="n">register_merge_strategy</span><span class="p">(</span><span class="s1">&#39;custom.field&#39;</span><span class="p">,</span> <span class="n">merge_custom_field</span><span class="p">)</span>
</code></pre></div>

<h2 id="performance-considerations">Performance Considerations</h2>
<h3 id="caching">Caching</h3>
<p>LLM responses are expensive. Consider caching:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_with_cache</span><span class="p">(</span>
    <span class="n">source_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">cache_dir</span><span class="p">:</span> <span class="n">Path</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="c1"># Compute cache key</span>
    <span class="n">file_hash</span> <span class="o">=</span> <span class="n">sha256_file</span><span class="p">(</span><span class="n">source_file</span><span class="p">)</span>
    <span class="n">cache_file</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_hash</span><span class="si">}</span><span class="s2">.intent.yaml&quot;</span>

    <span class="c1"># Check cache</span>
    <span class="k">if</span> <span class="n">cache_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">cache_file</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>

    <span class="c1"># Extract (expensive)</span>
    <span class="n">intent</span> <span class="o">=</span> <span class="n">extract_intent</span><span class="p">(</span><span class="n">source_file</span><span class="p">)</span>

    <span class="c1"># Save to cache</span>
    <span class="n">cache_file</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">intent</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">intent</span>
</code></pre></div>

<h3 id="parallel-processing">Parallel Processing</h3>
<p>For large workspaces with many files:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>

<span class="k">def</span><span class="w"> </span><span class="nf">extract_all_parallel</span><span class="p">(</span>
    <span class="n">input_files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
    <span class="n">max_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">futures</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">extract_intent</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span> <span class="n">f</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">input_files</span>
        <span class="p">}</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">futures</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
            <span class="n">results</span><span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">results</span>
</code></pre></div>

<h2 id="security-considerations">Security Considerations</h2>
<h3 id="api-key-management">API Key Management</h3>
<ul>
<li>Never store API keys in <code>ops-translate.yaml</code></li>
<li>Always use environment variables</li>
<li>Support <code>.env</code> files for local development</li>
<li>Mask API keys in logs</li>
</ul>
<h3 id="file-system-security">File System Security</h3>
<ul>
<li>Validate all file paths to prevent directory traversal</li>
<li>Check file sizes before reading</li>
<li>Sanitize file names during import</li>
<li>Use SHA-256 for integrity verification</li>
</ul>
<h3 id="llm-safety">LLM Safety</h3>
<ul>
<li>Set reasonable token limits to prevent cost overruns</li>
<li>Implement timeout for API calls</li>
<li>Validate LLM responses before using</li>
<li>Log all LLM interactions for auditability</li>
</ul>
<h2 id="testing-architecture">Testing Architecture</h2>
<h3 id="test-pyramid">Test Pyramid</h3>
<div class="codehilite"><pre><span></span><code>                ┌────────────┐
                │ Integration│  (10 tests)
                │   Tests    │
                └────────────┘
              ┌────────────────┐
              │  Component     │  (30 tests)
              │    Tests       │
              └────────────────┘
          ┌──────────────────────┐
          │    Unit Tests        │  (60+ tests)
          │                      │
          └──────────────────────┘
</code></pre></div>

<h3 id="test-structure">Test Structure</h3>
<div class="codehilite"><pre><span></span><code>tests/
├── test_cli.py           # CLI command tests
├── test_integration.py   # End-to-end workflow tests
├── test_llm.py          # LLM provider tests
├── test_merge.py        # Merge logic tests
├── test_summarize.py    # Summarization tests
├── test_util.py         # Utility function tests
└── test_workspace.py    # Workspace management tests
</code></pre></div>

<h3 id="mock-llm-for-testing">Mock LLM for Testing</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MockProvider</span><span class="p">(</span><span class="n">LLMProvider</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mock LLM provider for testing.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Return predefined intent based on prompt content</span>
        <span class="k">if</span> <span class="s1">&#39;powercli&#39;</span> <span class="ow">in</span> <span class="n">prompt</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">MOCK_POWERCLI_INTENT</span>
        <span class="k">elif</span> <span class="s1">&#39;vrealize&#39;</span> <span class="ow">in</span> <span class="n">prompt</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">MOCK_VREALIZE_INTENT</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MOCK_GENERIC_INTENT</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_available</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Always available</span>
</code></pre></div>

<h2 id="conclusion">Conclusion</h2>
<p>The ops-translate architecture is designed for:
- <strong>Safety</strong>: No destructive operations, transparent decision making
- <strong>Modularity</strong>: Clean component boundaries, swappable providers
- <strong>Simplicity</strong>: Filesystem-based state, no external dependencies
- <strong>Extensibility</strong>: Easy to add new sources, targets, and providers</p>
<p>For detailed usage instructions, see the <a href="USER_GUIDE.md">User Guide</a>.</p>
<p>For step-by-step tutorials, see <a href="TUTORIAL.md">TUTORIAL.md</a>.</p>
<p>For API reference, see <a href="API_REFERENCE.md">API_REFERENCE.md</a>.</p>
        </div>
        <div style="margin-top: var(--spacing-xl); text-align: center;">
            <a href="../index.html" class="back-to-report">← Back to Migration Report</a>
        </div>
    </div>
</body>
</html>
