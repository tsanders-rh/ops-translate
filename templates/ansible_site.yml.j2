---
# Generated by ops-translate from VMware automation sources
# Workflow: {{ intent.workflow_name }}
# Profile: {{ profile_name }}

- name: Provision Virtual Machine on OpenShift Virtualization
  hosts: localhost
  gather_facts: false
  connection: local

  vars:
{%- for param_name, param_spec in intent.inputs.items() %}
    {{ param_name }}: {% if param_spec.default is defined %}"{{ param_spec.default }}"{% else %}""  # Required{% endif %}

{%- endfor %}

  tasks:
    - name: Include provision_vm role
      ansible.builtin.include_role:
        name: provision_vm

  handlers:
    - name: Wait for VM to be ready
      kubernetes.core.k8s_info:
        api_version: kubevirt.io/v1
        kind: VirtualMachine
        name: "{{ '{{ vm_name }}' }}"
        namespace: {{ profile.default_namespace }}
      register: vm_status
      until: vm_status.resources | length > 0
      retries: 10
      delay: 5
