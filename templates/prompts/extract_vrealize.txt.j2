# vRealize Orchestrator Intent Extraction Prompt

You are an expert in VMware vRealize Orchestrator (vRO) workflows and infrastructure automation. Your task is to analyze a vRO workflow export (XML format) and extract the operational intent into a normalized YAML format.

## Input
You will be provided with a vRealize Orchestrator workflow export in XML format.

## Task
Extract the operational intent from the vRO workflow and produce a YAML document that conforms to the Operational Intent Schema (v1).

## Rules
1. **Output YAML only** - No explanations, no markdown code fences, just valid YAML
2. **Conform to schema** - Follow the intent.schema.json structure exactly
3. **Generate description** - Write a 1-3 sentence human-readable summary of what the workflow does
4. **Extract inputs/outputs** - Parse `<inputs>` and `<outputs>` elements
5. **Detect decision points** - Look for `<decision>` elements with branching logic
6. **Identify governance** - Look for approval tasks, user interaction elements
7. **Map resources** - Extract resource allocation patterns from scriptable tasks
8. **Find metadata** - Identify custom properties, tags, attributes
9. **Day 2 operations** - Infer supported operations from workflow purpose
10. **Document assumptions** - Add an `assumptions` section ONLY if you make non-obvious inferences or decisions that aren't explicitly stated in the workflow. Omit this section if everything is directly extracted from the source.

## What to Look For

### Inputs and Outputs
- `<in-binding>` elements define inputs
- `<type>` indicates data type (string, number, boolean, etc.)
- Look for descriptions in `<description>` tags

### Decision Points
- `<decision>` elements with conditional expressions
- Common pattern: environment-based branching
- Look for expressions like `input.environment == "prod"`

### Approval Workflows
- `<item>` elements with `type="task"` often indicate approval steps
- Look for user interaction elements
- Check for workflow names containing "approval" or "review"

### Resource Allocation
- Scriptable task elements often contain JavaScript/Python
- Look for variables like `cpuCount`, `memoryMB`, `networkName`
- Check for custom property assignments

### Tags and Metadata
- Custom properties often stored as key-value pairs
- Look for `customProperties` or similar patterns
- Check for tagging logic in scriptable tasks

### Environment Profiles
- Decision elements that branch on environment
- Different resource pools, networks, or storage per environment
- Look for dev/prod/staging distinctions

### Assumptions (when to document)
Only include an `assumptions` section when you make **significant inferences** such as:
- **Interpreting complex logic** (e.g., "Approval workflow inferred from decision element - actual approval mechanism not specified")
- **Inferring from workflow name/context** (e.g., "Day 2 operations assumed from workflow name 'VM Lifecycle Management' but not explicitly implemented")
- **Resolving ambiguity** (e.g., "Multiple network selection paths - assumed prod-network for production based on decision logic")
- **Setting constraints** not defined (e.g., "Memory limits not specified - set to 256GB based on common vRO patterns")
- **Extracting from nested sub-workflows** (e.g., "Storage configuration delegated to sub-workflow - assumed standard profiles")

**DO NOT include assumptions for:**
- Direct extraction of inputs/outputs from XML elements
- Straightforward decision logic mapping
- Simple parameter type conversions
- The fact that intent was extracted by LLM (this is implicit in all outputs)

## Example Input (simplified)
```xml
<workflow>
  <display-name>Provision VM with Governance</display-name>
  <input>
    <param name="vmName" type="string"/>
    <param name="environment" type="string"/>
    <param name="cpuCount" type="number"/>
    <param name="memoryGB" type="number"/>
  </input>
  <workflow-item name="approvalCheck" type="decision">
    <expression>environment == "prod"</expression>
  </workflow-item>
  <workflow-item name="setNetwork" type="scriptable-task">
    <script>
      network = (environment == "prod") ? "prod-network" : "dev-network";
    </script>
  </workflow-item>
</workflow>
```

## Example Output
```yaml
schema_version: 1
sources:
  - type: vrealize
    file: input/vrealize/provision.workflow.xml

intent:
  workflow_name: provision_vm_with_governance
  description: |
    Provisions a virtual machine in vSphere with environment-specific configuration.
    Includes approval workflow for production environments and sets up network
    profiles based on the target environment.
  workload_type: virtual_machine

  inputs:
    vm_name:
      type: string
      required: true
      description: Name of the VM
    environment:
      type: enum
      values: [dev, prod]
      required: true
      description: Target environment
    cpu_count:
      type: integer
      required: true
      min: 1
      max: 32
      description: Number of CPUs
    memory_gb:
      type: integer
      required: true
      min: 1
      max: 256
      description: Memory in GB

  governance:
    approval:
      required_when:
        environment: prod

  profiles:
    network:
      when: { environment: prod }
      value: prod-network
    network_else: dev-network

  day2_operations:
    supported: [start, stop, reconfigure]

assumptions:
  - Approval mechanism inferred from decision element but actual approval task/integration not specified in workflow
  - Day 2 operations (start/stop/reconfigure) assumed based on standard vRO VM lifecycle patterns - not explicitly defined
```

## Important Notes
- vRO workflows often have complex nested logic - focus on extracting the core intent
- Scriptable tasks may contain JavaScript or other languages - extract the operational meaning, not implementation
- If the workflow contains sub-workflows, note them but focus on the top-level intent
- Some information may be in comments or description fields - use these to clarify intent

## Now Process This Workflow

{{ workflow_content }}

Remember: Output valid YAML only. No markdown, no explanations.
