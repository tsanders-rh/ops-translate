<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Translation Report - {{ workspace.name }}</title>
    <link rel="stylesheet" href="assets/style.css">
</head>
<body>
    <!-- Header -->
    <header class="report-header">
        <div class="container">
            <div class="header-content">
                <h1>ops-translate</h1>
                <div class="header-meta">
                    <span class="workspace-name">{{ workspace.name }}</span>
                    <span class="separator">|</span>
                    <span class="profile-name">Profile: {{ profile.name }}</span>
                    <span class="separator">|</span>
                    <span class="timestamp">{{ workspace.timestamp[:19] }}</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Executive Summary -->
    {% if executive_summary %}
    <section class="executive-summary-section">
        <div class="container">
            <div class="executive-summary">
                <div class="executive-icon">üìã</div>
                <p class="executive-text">{{ executive_summary }}</p>
            </div>

            <!-- Export Actions -->
            <div class="export-actions">
                <button id="export-pdf" class="export-btn export-pdf">
                    <span class="export-icon">üìÑ</span>
                    <span>Export as PDF</span>
                </button>
                <button id="export-csv" class="export-btn export-csv">
                    <span class="export-icon">üìä</span>
                    <span>Export Migration Tasks (CSV)</span>
                </button>
            </div>
        </div>
    </section>
    {% endif %}

    <!-- At a Glance Summary Cards -->
    <section class="summary-section">
        <div class="container">
            <h2>Translation Status</h2>
            <div class="summary-cards">
                <div class="card card-supported" data-filter="SUPPORTED" title="Components that can be fully automatically translated to OpenShift-native equivalents">
                    <div class="card-icon">‚úÖ</div>
                    <div class="card-content">
                        <div class="card-number">{{ summary.counts.SUPPORTED }}</div>
                        <div class="card-label">Supported</div>
                    </div>
                </div>
                <div class="card card-partial" data-filter="PARTIAL" title="Core intent detected, but target platform mapping requires manual decisions">
                    <div class="card-icon">‚ö†Ô∏è</div>
                    <div class="card-content">
                        <div class="card-number">{{ summary.counts.PARTIAL }}</div>
                        <div class="card-label">Partial Translation</div>
                    </div>
                </div>
                <div class="card card-blocked" data-filter="BLOCKED" title="Components that require architectural design decisions and expert-guided implementation">
                    <div class="card-icon">üìê</div>
                    <div class="card-content">
                        <div class="card-number">{{ summary.counts.BLOCKED }}</div>
                        <div class="card-label">Design Required</div>
                    </div>
                </div>
                <div class="card card-manual" data-filter="MANUAL" title="Components with complex custom logic requiring specialist review and implementation">
                    <div class="card-icon">üîß</div>
                    <div class="card-content">
                        <div class="card-number">{{ summary.counts.MANUAL }}</div>
                        <div class="card-label">Custom</div>
                    </div>
                </div>
            </div>

            {% if summary.overall_assessment %}
            <div class="overall-assessment">
                <strong>Overall Assessment:</strong>
                {% if summary.overall_assessment == "FULLY_TRANSLATABLE" %}
                <span class="badge badge-success">Fully Translatable</span>
                {% elif summary.overall_assessment == "HAS_BLOCKING_ISSUES" %}
                <span class="badge badge-warning">Requires Design Decisions</span>
                {% elif summary.overall_assessment == "MOSTLY_MANUAL" %}
                <span class="badge badge-error">Mostly Manual</span>
                {% else %}
                <span class="badge badge-info">{{ summary.overall_assessment.replace('_', ' ').title() }}</span>
                {% endif %}
            </div>
            {% endif %}

            <!-- Migration Paths Quick Reference -->
            {% if gaps and gaps.components %}
            <div class="migration-paths-quick">
                <h4>Migration Paths Used in This Report</h4>
                <div class="paths-grid">
                    <div class="path-item">
                        <span class="badge badge-path-a">PATH A</span>
                        <span class="path-desc">Native OpenShift replacement</span>
                    </div>
                    <div class="path-item">
                        <span class="badge badge-path-b">PATH B</span>
                        <span class="path-desc">Hybrid approach (keep existing)</span>
                    </div>
                    <div class="path-item">
                        <span class="badge badge-path-c">PATH C</span>
                        <span class="path-desc">Custom specialist implementation</span>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Next Steps Callout -->
            {% if summary.has_blocking_issues and gaps and gaps.components %}
            <div class="next-steps-callout">
                <h3>üìê Design Decisions Required</h3>
                {% for component in gaps.components %}
                    {% if component.level == "BLOCKED" %}
                    <div class="blocking-item">
                        <p class="blocking-component"><strong>{{ component.name }}</strong> requires architectural design.</p>
                        <p class="blocking-guidance">
                            {% if component.recommendations and component.recommendations|length > 0 %}
                            {{ component.recommendations[0] }}
                            {% else %}
                            Migration will require custom implementation with expert guidance.
                            {% endif %}
                        </p>
                    </div>
                    {% endif %}
                {% endfor %}
                <p class="callout-footer">These components require design work but are solvable with expert-guided implementation.</p>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- ================================================================ -->
    <!-- LAYER 2: ARCHITECTURE IMPACT SUMMARY                             -->
    <!-- High-level design decisions, consolidated gaps, expert guidance  -->
    <!-- ================================================================ -->

    <!-- Expert Recommendations -->
    {% if recommendations and recommendations.recommendations %}
    <section class="recommendations-section layer-2">
        <div class="container">
            <h2>Expert-Guided Implementation Recommendations</h2>

            <div class="recommendations-intro">
                <p><strong>Actionable guidance for components requiring manual work.</strong> These expert recommendations provide step-by-step implementation guidance for workflow components that cannot be safely auto-migrated.</p>
                <p class="recommendations-note">‚ö†Ô∏è <strong>Important:</strong> These are recommendations, not drop-in replacements. Each recommendation requires review, testing, and validation before production use.</p>
            </div>

            <!-- Group recommendations by owner team -->
            {% set rec_by_owner = {} %}
            {% for rec in recommendations.recommendations %}
                {% set owner = rec.owner %}
                {% if owner not in rec_by_owner %}
                    {% set _ = rec_by_owner.update({owner: []}) %}
                {% endif %}
                {% set _ = rec_by_owner[owner].append(rec) %}
            {% endfor %}

            <!-- Team ownership tabs/filter -->
            <div class="recommendation-filters">
                <span class="filter-label">Filter by team:</span>
                <button class="rec-filter-btn active" data-team="all">All Teams ({{ recommendations.recommendations | length }})</button>
                {% for owner, recs in rec_by_owner.items() | sort %}
                <button class="rec-filter-btn" data-team="{{ owner }}">{{ owner }} ({{ recs | length }})</button>
                {% endfor %}
            </div>

            <!-- Recommendations list -->
            <div class="recommendations-list">
                {% for rec in recommendations.recommendations %}
                <div class="recommendation-card" data-team="{{ rec.owner }}">
                    <div class="recommendation-header">
                        <h3>{{ rec.component_name }}</h3>
                        <div class="recommendation-badges">
                            <span class="badge badge-owner">{{ rec.owner }}</span>
                            <span class="badge badge-component-type">{{ rec.component_type }}</span>
                        </div>
                    </div>

                    <div class="recommendation-body">
                        <!-- Why not auto-translatable -->
                        <div class="recommendation-section">
                            <h4>Why Not Auto-Translatable</h4>
                            <p>{{ rec.reason_not_auto_translatable }}</p>
                        </div>

                        <!-- Recommended approach -->
                        <div class="recommendation-section">
                            <h4>Recommended Ansible Approach</h4>
                            <p>{{ rec.ansible_approach }}</p>
                        </div>

                        <!-- OpenShift primitives -->
                        {% if rec.openshift_primitives %}
                        <div class="recommendation-section">
                            <h4>OpenShift/Kubernetes Primitives</h4>
                            <ul class="primitives-list">
                                {% for primitive in rec.openshift_primitives %}
                                <li><code>{{ primitive }}</code></li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        <!-- Implementation steps (collapsible) -->
                        {% if rec.implementation_steps %}
                        <details class="recommendation-details">
                            <summary><h4>Implementation Steps</h4></summary>
                            <ol class="implementation-steps">
                                {% for step in rec.implementation_steps %}
                                <li>{{ step }}</li>
                                {% endfor %}
                            </ol>
                        </details>
                        {% endif %}

                        <!-- Required inputs (collapsible) -->
                        {% if rec.required_inputs %}
                        <details class="recommendation-details">
                            <summary><h4>Required Inputs</h4></summary>
                            <dl class="required-inputs">
                                {% for var_name, description in rec.required_inputs.items() %}
                                <dt><code>{{ var_name }}</code></dt>
                                <dd>{{ description }}</dd>
                                {% endfor %}
                            </dl>
                        </details>
                        {% endif %}

                        <!-- Testing guidance (collapsible) -->
                        {% if rec.testing_guidance %}
                        <details class="recommendation-details">
                            <summary><h4>Testing & Validation</h4></summary>
                            <p>{{ rec.testing_guidance }}</p>
                        </details>
                        {% endif %}

                        <!-- References -->
                        {% if rec.references %}
                        <div class="recommendation-section">
                            <h4>References</h4>
                            <ul class="references-list">
                                {% for reference in rec.references %}
                                <li><a href="{{ reference }}" target="_blank" rel="noopener noreferrer">{{ reference }}</a></li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        <!-- Role stub info -->
                        {% if rec.ansible_role_stub %}
                        <div class="recommendation-footer">
                            <span class="role-stub-info">üìÅ Role stub will be generated at: <code>output/ansible/roles/{{ rec.ansible_role_stub }}/</code></span>
                            <p class="role-stub-note">Run <code>ops-translate generate --format ansible --profile &lt;profile&gt;</code> to create the role stub with implementation guidance.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}

    <!-- ================================================================ -->
    <!-- LAYER 3: IMPLEMENTATION DETAILS                                  -->
    <!-- File-by-file analysis, raw intent, detailed artifacts            -->
    <!-- ================================================================ -->

    <!-- Workflow Inventory -->
    {% if sources %}
    <section class="inventory-section layer-3">
        <div class="container">
            <h2>Source Files</h2>
            <table class="inventory-table">
                <thead>
                    <tr>
                        <th>File Name</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for source in sources %}
                    <tr>
                        <td class="file-name">{{ source.name }}</td>
                        <td>
                            {% if source.type == "PowerCLI" %}
                            <span class="badge badge-powercli">PowerCLI</span>
                            {% else %}
                            <span class="badge badge-vrealize">vRealize</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if source.status %}
                            <span class="status-{{ source.status.lower() }}">{{ source.status_icon }} {{ source.status_text }}</span>
                            {% else %}
                            <span class="status-unknown">‚ö† Needs Review</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if source.component_count and source.component_count > 0 %}
                            <a href="#file-{{ source.name | replace('.', '-') }}" class="action-link">View Findings</a>
                            {% else %}
                            <span class="no-action">Review intent</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
    {% endif %}

    <!-- Intent Overview -->
    {% if intent %}
    <section class="intent-section layer-3">
        <div class="container">
            <h2>Intent Overview</h2>
            <div class="intent-content">
                {% if intent.intent %}
                <!-- Workflow Info -->
                {% if intent.intent.workflow_name %}
                <div class="intent-block">
                    <h3>Workflow</h3>
                    <p><strong>Name:</strong> {{ intent.intent.workflow_name }}</p>
                    {% if intent.intent.workload_type %}
                    <p><strong>Workload Type:</strong> {{ intent.intent.workload_type }}</p>
                    {% endif %}
                    {% if intent.intent.description %}
                    <div class="workflow-description">
                        <h4>Description</h4>
                        <p>{{ intent.intent.description }}</p>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Inputs -->
                {% if intent.intent.inputs %}
                <div class="intent-block">
                    <h3>Inputs</h3>
                    <ul>
                        {% for input_name, input_spec in intent.intent.inputs.items() %}
                        <li>
                            <code>{{ input_name }}</code>
                            ({{ input_spec.type }})
                            {% if input_spec.required %}
                            <span class="badge badge-required">required</span>
                            {% endif %}
                            {% if input_spec.get('values') %}
                            - values: {{ input_spec.get('values') | join(', ') }}
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                <!-- Compute -->
                {% if intent.intent.compute %}
                <div class="intent-block">
                    <h3>Compute</h3>
                    {% if intent.intent.compute.cpu_cores %}
                    <p><strong>CPU Cores:</strong> {{ intent.intent.compute.cpu_cores }}</p>
                    {% endif %}
                    {% if intent.intent.compute.memory_mb %}
                    <p><strong>Memory:</strong> {{ intent.intent.compute.memory_mb }} MB</p>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Networking -->
                {% if intent.intent.networking %}
                <div class="intent-block">
                    <h3>Networking</h3>
                    {% for net in intent.intent.networking %}
                    <div class="network-item">
                        {% if net.name %}
                        <p><strong>Network:</strong> {{ net.name }}</p>
                        {% endif %}
                        {% if net.type %}
                        <p><strong>Type:</strong> {{ net.type }}</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Storage -->
                {% if intent.intent.storage %}
                <div class="intent-block">
                    <h3>Storage</h3>
                    {% for disk in intent.intent.storage %}
                    <div class="storage-item">
                        {% if disk.size_gb %}
                        <p><strong>Size:</strong> {{ disk.size_gb }} GB</p>
                        {% endif %}
                        {% if disk.type %}
                        <p><strong>Type:</strong> {{ disk.type }}</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Governance -->
                {% if intent.intent.governance %}
                <div class="intent-block">
                    <h3>Governance</h3>
                    {% if intent.intent.governance.approval %}
                    <p><strong>Approval Required:</strong>
                        {% if intent.intent.governance.approval.required_when %}
                        When {{ intent.intent.governance.approval.required_when | tojson }}
                        {% else %}
                        Yes
                        {% endif %}
                    </p>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Show YAML -->
                <details class="yaml-toggle">
                    <summary>Show Raw YAML</summary>
                    <pre><code>{{ intent | tojson(indent=2) }}</code></pre>
                </details>
                {% endif %}
            </div>
        </div>
    </section>
    {% else %}
    <section class="intent-section layer-3">
        <div class="container">
            <h2>Intent Overview</h2>
            <div class="alert alert-warning">
                No intent data found. Run <code>ops-translate intent extract</code> to generate intent.
            </div>
        </div>
    </section>
    {% endif %}

    <!-- Gaps & Migration Paths -->
    {% if gaps and gaps.components %}
    <section class="gaps-section layer-3">
        <div class="container">
            <h2>Gaps & Migration Guidance</h2>

            <!-- Filter Indicator -->
            <div id="filter-indicator" class="filter-indicator hidden">
                <span class="filter-text">Filtering by: <strong id="filter-name"></strong></span>
                <button id="clear-filter" class="clear-filter-btn">Clear Filter ‚úï</button>
            </div>

            {% if summary.has_blocking_issues %}
            <div class="alert alert-error">
                <strong>‚ö†Ô∏è Action Required:</strong> This workflow contains components that cannot be automatically translated. Manual implementation or architectural changes will be required.
            </div>
            {% elif summary.requires_manual_work %}
            <div class="alert alert-warning">
                <strong>‚ÑπÔ∏è Manual Configuration Needed:</strong> This workflow can be mostly automated, but some components require manual configuration or review.
            </div>
            {% else %}
            <div class="alert alert-success">
                <strong>‚úÖ Ready for Automatic Translation:</strong> All components in this workflow can be automatically translated to OpenShift-native equivalents.
            </div>
            {% endif %}

            <!-- Migration Path Legend -->
            <div class="migration-legend">
                <h3>Migration Paths</h3>
                <div class="legend-items">
                    <div class="legend-item">
                        <span class="badge badge-path-a">PATH A</span>
                        <span class="legend-description">OpenShift-native replacement available - can be automatically translated</span>
                    </div>
                    <div class="legend-item">
                        <span class="badge badge-path-b">PATH B</span>
                        <span class="legend-description">Hybrid approach - keep existing system temporarily while planning migration</span>
                    </div>
                    <div class="legend-item">
                        <span class="badge badge-path-c">PATH C</span>
                        <span class="legend-description">Custom specialist implementation required - significant effort needed</span>
                    </div>
                </div>
            </div>

            <!-- Component List -->
            <div class="gaps-list">
                {# Create mapping from base filename to full source filename #}
                {% set location_to_source = {} %}
                {% for source in sources %}
                    {% set base_name = source.name.replace('.workflow.xml', '').replace('.ps1', '') %}
                    {% set _ = location_to_source.update({base_name: source.name}) %}
                {% endfor %}

                {# Sort components by file, then by severity (DESIGN REQUIRED ‚Üí MANUAL ‚Üí PARTIAL ‚Üí SUPPORTED) #}
                {% set severity_order = {'BLOCKED': 0, 'MANUAL': 1, 'PARTIAL': 2, 'SUPPORTED': 3} %}
                {% set sorted_components = gaps.components | sort(attribute='location') %}
                {% set sorted_components = sorted_components | sort(attribute='level', case_sensitive=False) %}

                {# Group by file and sort within each group by severity #}
                {% set file_groups = {} %}
                {% for comp in gaps.components %}
                    {% set file_name = comp.location.split(':')[0] if comp.location else 'unknown' %}
                    {% if file_name not in file_groups %}
                        {% set _ = file_groups.update({file_name: []}) %}
                    {% endif %}
                    {% set _ = file_groups[file_name].append(comp) %}
                {% endfor %}

                {# Sort components within each file by severity #}
                {% for file_name, components in file_groups.items() | sort %}
                    {% set sorted_file_components = components | sort(attribute='level') %}

                    {# Use full source filename for anchor if available #}
                    {% set anchor_name = location_to_source.get(file_name, file_name) %}
                    <div id="file-{{ anchor_name | replace('.', '-') }}" class="file-anchor"></div>

                    {# Add visual file header for grouping #}
                    <div class="file-section-header">
                        <div class="file-icon">üìÑ</div>
                        <h3>{{ anchor_name }}</h3>
                        {% set file_type = 'VREALIZE' if '.workflow.xml' in anchor_name else 'POWERCLI' if '.ps1' in anchor_name else 'UNKNOWN' %}
                        <span class="badge badge-{{ file_type.lower() }}">{{ file_type }}</span>
                    </div>

                    {% for component in sorted_file_components | sort(attribute='level') %}
                    <div class="gap-item gap-{{ component.level.lower() }}" data-level="{{ component.level }}">
                    <div class="gap-header">
                        <h3>
                            {{ component.name }}
                            {# Add vRealize-specific indicators #}
                            {% if 'approval' in component.component_type %}
                            <span class="vrealize-indicator" title="vRealize Approval Workflow">‚öôÔ∏è Approval</span>
                            {% endif %}
                            {% if 'orchestration' in component.component_type %}
                            <span class="vrealize-indicator" title="vRealize Orchestration Complexity">üîÑ Orchestration</span>
                            {% endif %}
                            {% if 'vro_plugin' in component.component_type or 'vro_' in component.component_type %}
                            <span class="vrealize-indicator" title="vRO Plugin/Integration">üîå vRO Plugin</span>
                            {% endif %}
                            {% if 'nsx' in component.component_type %}
                            <span class="vrealize-indicator vrealize-indicator-nsx" title="NSX-T Component">üîí NSX-T</span>
                            {% endif %}
                        </h3>
                        <span class="badge badge-{{ component.level.lower() }}">{{ component.level }}</span>
                    </div>
                    <div class="gap-body">
                        <p><strong>Type:</strong> {{ component.component_type }}</p>
                        {% if component.location %}
                        <p><strong>Location:</strong> <code>{{ component.location }}</code></p>
                        {% endif %}
                        <p><strong>Reason:</strong> {{ component.reason }}</p>

                        {% if component.openshift_equivalent %}
                        <p><strong>OpenShift Equivalent:</strong> {{ component.openshift_equivalent }}</p>
                        {% endif %}

                        {% if component.migration_path %}
                        <p><strong>Migration Path:</strong>
                            {% if component.migration_path == "PATH_A" %}
                            <span class="badge badge-path-a">PATH A</span>
                            <span class="path-description">OpenShift-native replacement available</span>
                            {% elif component.migration_path == "PATH_B" %}
                            <span class="badge badge-path-b">PATH B</span>
                            <span class="path-description">Hybrid approach - keep existing temporarily</span>
                            {% elif component.migration_path == "PATH_C" %}
                            <span class="badge badge-path-c">PATH C</span>
                            <span class="path-description">Custom specialist implementation required</span>
                            {% else %}
                            <span class="badge badge-path">{{ component.migration_path }}</span>
                            {% endif %}
                        </p>
                        {% endif %}

                        {% if component.recommendations %}
                        <div class="recommendations">
                            <strong>Recommendations:</strong>
                            <ul>
                                {% for rec in component.recommendations %}
                                <li>{{ rec }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}

                        {% if component.evidence %}
                        <details class="evidence-toggle">
                            <summary>Show Evidence</summary>
                            <pre><code>{{ component.evidence }}</code></pre>
                        </details>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
                {# End of components loop #}
                {% endfor %}
                {# End of file_groups loop #}
            </div>
        </div>
    </section>
    {% endif %}

    <!-- Hybrid Retention Section -->
    {% if gaps and gaps.components %}
    {% set hybrid_components = [] %}
    {% for component in gaps.components %}
        {% if component.migration_path == "PATH_B" %}
            {% set _ = hybrid_components.append(component) %}
        {% endif %}
    {% endfor %}
    {% if hybrid_components %}
    <section class="hybrid-section layer-3">
        <div class="container">
            <h2>What Stays in VMware / NSX (Hybrid Approach)</h2>

            <div class="hybrid-intro">
                <p><strong>Hybrid architectures are a valid migration strategy.</strong> The following components can remain in your existing VMware/NSX environment while you migrate workloads to OpenShift.</p>
            </div>

            <div class="hybrid-list">
                {% for component in hybrid_components %}
                <div class="hybrid-item">
                    <div class="hybrid-header">
                        <h3>{{ component.name }}</h3>
                        <span class="badge badge-path-b">PATH B</span>
                    </div>
                    <p class="hybrid-reason">{{ component.reason }}</p>
                    {% if component.recommendations %}
                    <div class="hybrid-guidance">
                        <strong>Hybrid Integration:</strong>
                        <ul>
                            {% for rec in component.recommendations[:3] %}
                            <li>{{ rec }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>

            <div class="hybrid-footer">
                <p>üí° <strong>Why Hybrid?</strong> Retaining proven infrastructure reduces migration risk and allows incremental modernization. You can evaluate OpenShift-native alternatives on your timeline.</p>
            </div>
        </div>
    </section>
    {% endif %}
    {% endif %}

    <!-- Generated Artifacts -->
    {% if artifacts.kubevirt or artifacts.ansible %}
    <section class="artifacts-section layer-3">
        <div class="container">
            <h2>Generated Artifacts</h2>

            {% if artifacts.kubevirt %}
            <div class="artifact-group">
                <h3>KubeVirt Manifests</h3>
                <ul class="artifact-list">
                    {% for artifact in artifacts.kubevirt %}
                    <li>
                        <span class="artifact-name">{{ artifact.name }}</span>
                        <span class="artifact-path">{{ artifact.path }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if artifacts.ansible %}
            <div class="artifact-group">
                <h3>Ansible Playbooks & Roles</h3>
                <ul class="artifact-list">
                    {% for artifact in artifacts.ansible %}
                    <li>
                        <span class="artifact-name">{{ artifact.name }}</span>
                        <span class="artifact-path">{{ artifact.path }}</span>
                        {% if artifact.type == "role" and artifact.name.startswith("role: custom_") %}
                        <span class="badge badge-warning">Manual Work Required</span>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- What's Next Checklist -->
            <div class="next-steps">
                <h3>What's Next?</h3>
                <ul class="checklist">
                    {% if gaps and gaps.components %}
                    <li>Review gaps and migration guidance above</li>
                    {% endif %}
                    {% if assumptions_md %}
                    <li>Review assumptions (see below)</li>
                    {% endif %}
                    <li>Run <code>ops-translate dry-run</code> to validate configuration</li>
                    <li>Apply generated artifacts in a lab environment first</li>
                    <li>Test functionality before promoting to production</li>
                </ul>
            </div>
        </div>
    </section>
    {% else %}
    <section class="artifacts-section layer-3">
        <div class="container">
            <h2>Generated Artifacts</h2>
            <div class="alert alert-info">
                No artifacts generated yet. Run <code>ops-translate generate --profile {{ profile.name }}</code> to generate KubeVirt and Ansible artifacts.
            </div>
        </div>
    </section>
    {% endif %}

    <!-- Assumptions -->
    {% if assumptions_md %}
    <section class="appendix-section layer-3">
        <div class="container">
            <details class="appendix-content">
                <summary><h2>Assumptions</h2></summary>
                <div class="markdown-content">
                    {{ assumptions_md | safe }}
                </div>
            </details>
        </div>
    </section>
    {% endif %}

    <!-- Conflicts -->
    {% if conflicts_md %}
    <section class="appendix-section layer-3">
        <div class="container">
            <details class="appendix-content">
                <summary><h2>Conflicts</h2></summary>
                <div class="conflicts-impact">
                    <strong>Impact:</strong> These conflicts do not block migration, but must be resolved for clean parameter validation and artifact generation.
                </div>
                <div class="markdown-content alert-warning">
                    {{ conflicts_md | safe }}
                </div>
            </details>
        </div>
    </section>
    {% endif %}

    <!-- Footer -->
    <footer class="report-footer">
        <div class="container">
            <p>Generated by <strong>ops-translate</strong> at {{ workspace.timestamp[:19] }}</p>
            <p class="disclaimer">This report is read-only and for review purposes. No changes will be applied automatically.</p>
        </div>
    </footer>

    <script>
        // Pass gaps data to JavaScript for CSV export
        window.reportData = {
            workspace: "{{ workspace.name }}",
            timestamp: "{{ workspace.timestamp[:19] }}",
            gaps: {{ gaps | tojson | safe if gaps else '{}' }}
        };
    </script>
    <script src="assets/app.js"></script>
</body>
</html>
