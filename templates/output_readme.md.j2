# Generated Artifacts - {{ intent.workflow_name }}

Generated by **ops-translate** from VMware automation sources.

Profile: **{{ profile_name }}**

## Overview

This directory contains the generated artifacts for deploying virtual machines on OpenShift Virtualization using KubeVirt.

### Source Intent
- **Workflow**: {{ intent.workflow_name }}
- **Workload Type**: {{ intent.workload_type }}
{%- if intent.sources %}
- **Source Files**:
{%- for source in intent.sources %}
  - {{ source.type }}: `{{ source.file }}`
{%- endfor %}
{%- endif %}

## Directory Structure

```
output/
├── kubevirt/
│   └── vm.yaml              # KubeVirt VirtualMachine manifest
├── ansible/
│   ├── site.yml             # Main Ansible playbook
│   └── roles/
│       └── provision_vm/
│           ├── tasks/main.yml
│           └── defaults/main.yml
└── README.md                # This file
```

## Prerequisites

Before running the Ansible playbook, ensure you have:

1. **OpenShift CLI (oc)** or **kubectl** installed and configured
2. **Ansible** 2.9+ installed
3. **Ansible Kubernetes collection**:
   ```bash
   ansible-galaxy collection install kubernetes.core
   ```
4. **Access to OpenShift cluster** with KubeVirt installed
5. **Permissions** to create VirtualMachine resources in namespace `{{ profile.default_namespace }}`

## Configuration

### Required Parameters
{%- for param_name, param_spec in intent.inputs.items() %}
{%- if param_spec.required %}
- **{{ param_name }}**: {{ param_spec.description if param_spec.description else '(no description)' }}
{%- if param_spec.type == 'enum' %}
  - Allowed values: {{ param_spec.values | join(', ') }}
{%- endif %}
{%- if param_spec.type == 'integer' and (param_spec.min is defined or param_spec.max is defined) %}
  - Range: {{ param_spec.min if param_spec.min is defined else '?' }} - {{ param_spec.max if param_spec.max is defined else '?' }}
{%- endif %}
{%- endif %}
{%- endfor %}

### Optional Parameters
{%- for param_name, param_spec in intent.inputs.items() %}
{%- if not param_spec.required %}
- **{{ param_name }}**: {{ param_spec.description if param_spec.description else '(no description)' }}
{%- if param_spec.default is defined %}
  - Default: `{{ param_spec.default }}`
{%- endif %}
{%- endif %}
{%- endfor %}

## Usage

### Option 1: Using Ansible Playbook

```bash
cd ansible

# Run with extra vars
ansible-playbook site.yml -e "vm_name=my-vm environment=dev cpu=4 memory_gb=8"

# Or create a vars file
cat > vars.yml <<EOF
vm_name: my-test-vm
{%- for param_name, param_spec in intent.inputs.items() %}
{%- if param_name != 'vm_name' %}
{{ param_name }}: {% if param_spec.default is defined %}{{ param_spec.default }}{% else %}""  # TODO: set value{% endif %}

{%- endif %}
{%- endfor %}
EOF

ansible-playbook site.yml -e @vars.yml
```

### Option 2: Direct kubectl/oc Apply

```bash
# Edit kubevirt/vm.yaml and replace template variables
# Then apply directly:
oc apply -f kubevirt/vm.yaml
```

{%- if intent.governance and intent.governance.approval and intent.governance.approval.required_when %}

## Governance Notice

**⚠️ Approval Required**

This workflow includes approval requirements under certain conditions:
{%- for condition_var, condition_value in intent.governance.approval.required_when.items() %}
- When `{{ condition_var }}` is `{{ condition_value }}`
{%- endfor %}

Ensure proper approvals are obtained before proceeding with deployment.
{%- endif %}

{%- if intent.day2_operations and intent.day2_operations.supported %}

## Day 2 Operations

Supported operations:
{%- for operation in intent.day2_operations.supported %}
- **{{ operation }}**
{%- endfor %}

### Examples

```bash
# Start VM
oc patch vm/my-vm --type merge -p '{"spec":{"running":true}}'

# Stop VM
oc patch vm/my-vm --type merge -p '{"spec":{"running":false}}'

# Get VM status
oc get vm/my-vm
oc get vmi/my-vm
```
{%- endif %}

## Troubleshooting

### VM not starting
```bash
# Check VM status
oc describe vm/my-vm

# Check VMI (VirtualMachineInstance)
oc get vmi
oc describe vmi/my-vm

# Check pod logs
oc logs virt-launcher-my-vm-xxxxx
```

### Storage issues
```bash
# Check PVC status
oc get pvc

# Ensure storage class exists
oc get storageclass {{ profile.default_storage_class }}
```

### Network issues
```bash
# Check network attachments
oc get network-attachment-definitions

# Verify pod network
oc get pods -o wide
```

## Additional Resources

- [KubeVirt Documentation](https://kubevirt.io/user-guide/)
- [OpenShift Virtualization Documentation](https://docs.openshift.com/container-platform/latest/virt/about-virt.html)
- [ops-translate GitHub](https://github.com/tsanders-rh/ops-translate)

---
*Generated by ops-translate - {{ profile_name }} profile*
